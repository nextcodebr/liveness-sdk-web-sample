{"version":3,"sources":["webpack://Liveness/./src/Livenessv6.5.4.js","webpack://Liveness/webpack/bootstrap","webpack://Liveness/webpack/startup"],"names":["module","exports","constructor","videoWrapper","config","this","uploadInProgress","requestType","counterNotFoundFace","faceapi","token","configFrameBox","frameBox","scalingFactorForLiveness","width","getFullWidth","height","getFullHeight","heightAspectRatio","isMobile","isDebug","cssOrientationStyle","document","createElement","innerText","cssOrientationLock","head","appendChild","brightnessControl","luminanceControl","faceapiPath","isShowPreview","errorCallback","successCallback","livenessUrlBase","livenessConfirmEndpoint","ellipseStrokeStyleDefault","ellipseStrokeStyle","activatedEllipseStrokeStyle","boxMessageBackgroundColor","boxMessageTextColor","configEyesBoxHeight","requestAnimationFrame","window","shouldCheckNeutralFace","facetimeInterval","timeToDetectFace","showNotFoundModal","cameraPermissionErrorCallback","Math","max","body","scrollWidth","documentElement","offsetWidth","clientWidth","scrollHeight","offsetHeight","clientHeight","setUseBase64","setUseFormData","setMinBrightness","value","setMinLuminance","setFrameBoxesWidth","eyesInner","eyesOutter","box","setDimensionsRequestImage","dimensions","toggleDebug","canvas","getContext","clearRect","setEyesBoxHeight","pixels","stop","video","pause","stream","getTracks","forEach","track","clearInterval","timer","timerBackground","setCheckNeutralFace","callback","startCallbackFunction","console","log","setLiveness","loadFaceApi","setLoading","createVideoElement","startVideo","createModalConfirmationWrapper","createModalConfirmation","destroyLiveness","removeCanvas","resetVideoWrapper","resetLiveness","closePreviewModal","base64","removeLoading","createCanvasBackground","canvasBackground","getDevicePixelRatio","devicePixelRatio","style","display","sweepVideo","data","luminanceAvg","brightnessSum","luminanceArray","x","length","r","g","b","sweepBrightness","sweepLuminance","checkBrightness","test","navigator","userAgent","brightness","floor","canvasLuminance","calcLuminance","push","luminance","colorFactor","colorArray","i","pow","mediaQuery","isFirefox","toLowerCase","indexOf","undefined","matchMedia","matches","script","faceJS","src","append","onload","async","loadFaceApiModels","setTimeout","Promise","all","nets","faceLandmark68Net","loadFromUri","faceExpressionNet","faceRecognitionNet","then","tinyFaceDetector","catch","e","alert","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","resolve","reject","call","Error","enumerateDevices","devices","frameRate","facingMode","backCamera","filter","device","kind","label","includes","deviceId","querySelector","streamLiveness","srcObject","URL","createObjectURL","err","position","transform","setAttribute","addEventListener","loop","error","getElementById","innerHTML","getElementsByTagName","remove","responsiveFrameBoxEyesOutterWidth","windowWidth","createCanvasFromMedia","left","top","faceapiConfig","matchDimensions","boxesWidth","innerWidth","ellipseMaskWidth","ellipseMaskHeight","ellipseMaskTop","ellipseMaskLeft","ellipseMaskLineWidth","createMessageBox","ctx","translate","scale","drawEllipse","draw","isBackgroundOK","setInterval","checkBackground","state","counter","inProgress","done","canvasPosition","getBoundingClientRect","onLine","setHasNoNetwork","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","limitCounterFaceDiscovery","toggleModalFaceNotFound","blockMask","resizedDetections","resizeResults","expressions","expression","getExpression","detection","pose","getPose","jaw","landmarks","getJawOutline","isRotatedFace","beginPath","lineWidth","strokeStyle","moveTo","y","lineTo","stroke","leftEye","meanPosition","isInside","outterBox","innerBox","rightEye","activateEllipseMask","takePicture","deactivateEllipseMask","rect","w","h","ellipse","PI","expArr","key","Object","entries","confidence","exp","sort","a","pop","res","eye_right","getMeanPosition","getRightEye","eye_left","getLeftEye","nose","getNose","mouth","getMouth","rx","getTop","ry","score","p1","p2","abs","atan2","l","map","reduce","min","message","msg","elMessage","textContent","context","createFlashMask","drawImage","fillStyle","fillRect","pictureData","getImageData","putImageData","toDataURL","removeFlashMask","openPreviewModal","confirmPicture","table","brilho","atual","parseFloat","toFixed","flash","background","zIndex","id","modalWrapper","modalFaceNotFound","confirmButton","footer","modal","modalConfirmation","cancelButton","cancelPicture","image","downloadImage","anchor","click","insertAdjacentHTML","setLoadingProgress","spinner","getTips","tips","join","endpoint","xhr","XMLHttpRequest","open","setRequestHeader","upload","loaded","total","onreadystatechange","readyState","DONE","response","JSON","parse","isAlive","status","sendBase64","sendFormData","send","stringify","toB64","formData","toFormData","FormData","responseFetch","fetch","blob","split","sendPictureByXmlRequest","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"liveness.js","sourcesContent":["\"use strict\";\nclass Liveness {\n\n  constructor (videoWrapper, config) {\n    this.uploadInProgress = 0.00\n    this.requestType = 'b64'\n    this.counterNotFoundFace = 0\n    this.faceapi = null\n    this.token = config.token\n    this.videoWrapper = videoWrapper\n    this.configFrameBox = config.frameBox\n\n    if (config.scalingFactorForLiveness &&\n      config.scalingFactorForLiveness !== 0 &&\n        config.scalingFactorForLiveness <= 3) {\n      this.scalingFactorForLiveness = config.scalingFactorForLiveness\n    } else this.scalingFactorForLiveness = 1\n\n    this.config = {\n      width: config.width || this.getFullWidth(),\n      height: config.height || this.getFullHeight()\n    }\n\n    this.config.heightAspectRatio = this.isMobile()\n     ? this.config.width * (4 / 3)\n     : this.config.width / (4 / 3)\n    this.config.isDebug = config.isDebug\n\n    const cssOrientationStyle = document.createElement('style')\n    cssOrientationStyle.innerText = this.cssOrientationLock()\n    document.head.appendChild(cssOrientationStyle)\n    \n    if (config.brightnessControl) this.brightnessControl = config.brightnessControl\n    else this.brightnessControl = 95\n\n    if (config.luminanceControl) this.luminanceControl = config.luminanceControl\n    else this.luminanceControl = 23\n\n    this.faceapiPath = config.faceapiPath\n    this.isShowPreview = config.isShowPreview\n    this.errorCallback = config.errorCallback\n    this.successCallback = config.successCallback\n    this.livenessUrlBase = config.livenessUrlBase\n    this.livenessConfirmEndpoint = config.livenessConfirmEndpoint || '/liveness/v2'\n    this.ellipseStrokeStyleDefault = config.ellipseStrokeStyle || '#D02780'\n    this.activatedEllipseStrokeStyle = config.activatedEllipseStrokeStyle || '#46E3C3'\n    this.boxMessageBackgroundColor = config.boxMessageBackgroundColor || '#D02780'\n    this.boxMessageTextColor = config.boxMessageTextColor || '#f3f3f5'\n    this.configEyesBoxHeight = config.configEyesBoxHeight || 20\n    this.requestAnimationFrame = window.requestAnimationFrame\n    this.shouldCheckNeutralFace = config.shouldCheckNeutralFace || false\n    this.facetimeInterval = config.facetimeInterval || 150\n    this.timeToDetectFace = config.timeToDetectFace || 6000\n    this.showNotFoundModal = config.showNotFoundModal || false\n    this.cameraPermissionErrorCallback = config.cameraPermissionErrorCallback || null\n  }\n  getFullWidth () {\n    return Math.max(\n      document.body.scrollWidth,\n      document.documentElement.scrollWidth,\n      document.body.offsetWidth,\n      document.documentElement.offsetWidth,\n      document.documentElement.clientWidth\n    )\n  }\n  getFullHeight () {\n    return Math.max(\n      document.body.scrollHeight,\n      document.documentElement.scrollHeight,\n      document.body.offsetHeight,\n      document.documentElement.offsetHeight,\n      document.documentElement.clientHeight\n    );\n  }\n  setUseBase64 () {\n    this.requestType = \"b64\"\n  }\n\n  setUseFormData () {\n    this.requestType = \"formData\"\n  }\n\n  setMinBrightness (value) {\n    this.brightnessControl = value\n  }\n\n  setMinLuminance (value) {\n    this.luminanceControl = value\n  }\n\n  setFrameBoxesWidth (eyesInner, eyesOutter, box) {\n    this.configFrameBox = {\n      eyesInner,\n      eyesOutter,\n      box\n    }\n  }\n  setDimensionsRequestImage (width, height) {\n    this.config.dimensions = {\n      width,\n      height\n    }\n  }\n  toggleDebug () {\n    this.config.isDebug = !this.config.isDebug\n    if (!this.config.isDebug) {\n      const ctx = this.canvas.getContext('2d')\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    }\n  }\n\n  setEyesBoxHeight (pixels) {\n    this.configEyesBoxHeight = pixels\n  }\n\n  stop () {\n    this.video.pause()\n    const tracks = this.stream.getTracks()\n    tracks.forEach(track => track.stop())\n    clearInterval(this.timer)\n    clearInterval(this.timerBackground)\n  }\n\n  setCheckNeutralFace (value) {\n    this.shouldCheckNeutralFace = value\n  }\n\n  async start (callback) {\n    this.startCallbackFunction = callback\n    if (!window.faceapi) {\n      console.log('42')\n      await this.loadFaceApi()\n      console.log('43')\n    } else {\n      console.log('44')\n      this.faceapi = window.faceapi\n      this.setLiveness()\n    }\n  }\n\n  setLiveness () {\n    console.log('setLiveness')\n    this.setLoading()\n    this.createVideoElement()\n    .startVideo()\n    .createModalConfirmationWrapper()\n    .createModalConfirmation()\n  }\n\n  destroyLiveness () {\n    console.log('41')\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n  }\n\n  resetLiveness () {\n    console.log('40')\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n    this.closePreviewModal()\n    this.base64 = ''\n    this.removeLoading()\n    this.setLiveness()\n  }\n\n  cssOrientationLock () {\n    return '@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) { html { transform: rotate(-90deg);transform-origin: left top;width: 100vh;overflow-x: hidden;position: absolute;top: 100%;left: 0;}}'\n  }\n\n  createCanvasBackground () {\n    console.log('createCanvasBackground')\n    this.canvasBackground = document.createElement('canvas')\n    const width = this.videoWrapper.clientWidth * this.getDevicePixelRatio()\n    const height = this.videoWrapper.clientHeight * this.getDevicePixelRatio()\n    // if (window.innerWidth < 720) {\n    //   this.canvasBackground.width = width * 2\n    //   this.canvasBackground.height = height * 2\n    // } else {\n    //   this.canvasBackground.width = width\n    //   this.canvasBackground.height = height\n    // }\n\n    console.log('37')\n    this.canvasBackground.width = this.isMobile()\n      ? this.video.clientWidth * (window.devicePixelRatio || 2)\n      : this.config.width\n    this.canvasBackground.height = this.isMobile()\n      ? this.config.heightAspectRatio * (window.devicePixelRatio || 2)\n      : this.config.height\n    \n      console.log('38')\n    if (this.scalingFactorForLiveness) {\n      this.canvasBackground.width = this.canvasBackground.width * this.scalingFactorForLiveness\n      this.canvasBackground.height = this.canvasBackground.height * this.scalingFactorForLiveness\n    }\n    \n    console.log('39')\n    if (this.config.dimensions) {\n      this.canvasBackground.width = this.config.dimensions.width\n      this.canvasBackground.height = this.config.dimensions.height\n    }\n    this.canvasBackground.style.display = 'none'\n  }\n\n  sweepVideo (data) {\n    this.luminanceAvg = 0\n    this.brightnessSum = 0 \n    this.luminanceArray = []\n\n    for (let x = 0; x < data.length; x += 4) {\n      const r = data[x]\n      const g = data[x + 1]\n      const b = data[x + 2]\n      this.sweepBrightness(r, g, b)\n      this.sweepLuminance(r, g, b)\n    }\n    this.checkBrightness()\n  }\n\n  isMobile () {\n    console.log('36')\n    const acceptedBrowser = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\n    return acceptedBrowser.test(navigator.userAgent)\n  }\n\n  checkBrightness () {\n    this.brightness = Math.floor(this.brightnessSum / (this.canvasLuminance.width * this.canvasLuminance.height))\n  }\n\n  sweepBrightness (r, g, b) {\n    this.brightnessSum += Math.floor((r + g + b) / 3)\n  }\n\n  sweepLuminance (r, g, b) {\n    this.luminanceAvg += this.calcLuminance(r, g, b)\n    this.luminanceArray.push(this.calcLuminance(r, g, b))     \n\n    this.luminance = (this.luminanceAvg / this.luminanceArray?.length) * 100\n  }\n\n  calcLuminance (r, g, b) {\n    let colorArray = [r, g, b]\n    let colorFactor\n    for (let i = 0; i < colorArray.length; i++) {\n        colorFactor = colorArray[i] / 255\n        if (colorFactor <= 0.03928) {\n            colorFactor = colorFactor / 12.92\n        } else {\n            colorFactor = Math.pow(((colorFactor + 0.055) / 1.055), 2.4)\n        }\n        colorArray[i] = colorFactor\n    }\n    return (colorArray[0] * 0.2126 + colorArray[1] * 0.7152 + colorArray[2] * 0.0722) + 0.05\n  }\n  getDevicePixelRatio () {\n    let mediaQuery\n    const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1\n    if (window.devicePixelRatio !== undefined && !isFirefox) {\n      return window.devicePixelRatio\n    } else if (window.matchMedia) {\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 1.5),\\\n        (min--moz-device-pixel-ratio: 1.5),\\\n        (-o-min-device-pixel-ratio: 3/2),\\\n        (min-resolution: 1.5dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 1.5\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 2),\\\n        (min--moz-device-pixel-ratio: 2),\\\n        (-o-min-device-pixel-ratio: 2/1),\\\n        (min-resolution: 2dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 2\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 0.75),\\\n        (min--moz-device-pixel-ratio: 0.75),\\\n        (-o-min-device-pixel-ratio: 3/4),\\\n        (min-resolution: 0.75dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 1.5\n      }\n    } else {\n      return 1\n    }\n  }\n\n  async loadFaceApi () {\n    console.log('45')\n    const script = document.createElement('script')\n    const faceJS = `${this.faceapiPath}/face-api.min.js`\n    script.src = faceJS\n    console.log('46')\n    document.head.append(script)\n    script.onload = async () => {\n      console.log('47')\n      await this.loadFaceApiModels()\n      console.log('48')\n    }\n    return this\n  }\n  async loadFaceApiModels () {\n    setTimeout(async () => {\n      console.log('49')\n      Promise.all([\n        window.faceapi.nets.faceLandmark68Net.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceExpressionNet.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceRecognitionNet.loadFromUri(this.faceapiPath)\n      ])\n      .then(async () => {\n        console.log('50')\n        await window.faceapi.nets.tinyFaceDetector.loadFromUri(this.faceapiPath)\n        console.log('Models were loaded')\n        this.faceapi = faceapi\n        this.setLiveness()\n      })\n      .catch(e => alert('error', e))\n    }, 100)\n    return this\n  }\n\n  startVideo () {\n    console.log('startVideo')\n    console.log('51')\n    if (navigator.mediaDevices === undefined) {\n      navigator.mediaDevices = {}\n    }\n    console.log('1')\n    if (navigator.mediaDevices.getUserMedia === undefined) {\n      console.log('2')\n      navigator.mediaDevices.getUserMedia = function(constraints) {\n        console.log('3')\n        const getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n\n    console.log('4')\n        if (!getUserMedia) {\n          return Promise.reject(new Error('getUserMedia não implementado nesse browser'))\n        }\n        return new Promise(function(resolve, reject) {\n          console.log('5')\n          getUserMedia.call(navigator, constraints, resolve, reject)\n        })\n      }\n    }\n    navigator.mediaDevices.enumerateDevices()\n      .then(devices => {\n        console.log('6')\n      const constraints = {\n        video: {  \n          width: this.config.width,\n          height: this.config.height,\n          frameRate: 24\n        }\n      }\n      console.log('7')\n      if (this.isMobile()) constraints.video = { facingMode: 'user' }\n      else {\n        console.log('8')\n        const backCamera = devices.filter(device => device.kind === 'videoinput' && !device.label.includes('m-de:vice'))[0]\n        if (backCamera) constraints.video.deviceId = backCamera.deviceId\n      }\n\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then((stream) => {\n          console.log('9')\n          const video = document.querySelector('video')\n\n          if (!video) return\n\n          this.stream = stream\n          navigator.streamLiveness = stream\n          console.log('10')\n          if (\"srcObject\" in video) {\n            console.log('11')\n            video.srcObject = stream\n            console.log('12')\n          } else {\n            console.log('13')\n            video.src = window.URL.createObjectURL(stream)\n          }\n          console.log('iniciando video', video)\n          !!this.startCallbackFunction && this.startCallbackFunction()\n          console.log('14')\n        }).catch(err => {\n          console.log('erro de permissao de camera')\n          if (this.cameraPermissionErrorCallback) this.cameraPermissionErrorCallback(err)\n          else throw new Error(err)\n          console.log('15')\n        })\n    })\n    return this\n  }\n  createVideoElement () {\n    console.log('16')\n    this.videoWrapper.style.position = 'relative'\n    this.videoWrapper.style.width =  this.config.width + 'px'\n    this.videoWrapper.style.height = this.config.height < this.config.heightAspectRatio\n    ? this.config.height + 'px'\n    : this.config.heightAspectRatio + 'px'\n\n    console.log('17')\n    this.video = document.createElement('video')\n    this.video.style.width = 'inherit'\n    this.video.style.height = 'inherit'\n    this.video.style.transform = 'scaleX(-1)'\n    this.video.setAttribute('muted', true)\n    this.video.setAttribute('autoplay', true)\n    this.video.setAttribute('playsinline', '')\n    this.videoWrapper.append(this.video)\n    console.log('createVideoElement')\n    try {\n      this.video.addEventListener('play', () => {\n        console.log('listening play')\n        console.log('18')\n        this.loop()\n        this.createCanvasBackground()\n      })\n      return this\n    } catch (error) {\n      console.log('createVideoElement ERROR', error)\n    }\n  }\n  resetVideoWrapper () {\n    const videoWrapper = document.getElementById('video-wrapper')\n    if(videoWrapper) videoWrapper.innerHTML = ''\n  }\n\n  removeCanvas () {\n    const canvas = document.getElementsByTagName('canvas')[0]\n    if(canvas) canvas.remove()\n  }\n\n  responsiveFrameBoxEyesOutterWidth (windowWidth) {\n    switch (windowWidth) {\n      case 315:\n        return {\n          eyesInner: 0.74,\n          eyesOutter: 0.78,\n          box: 0.55\n        }\n        break;\n    \n      default:\n        return {\n          eyesInner: 0.52,\n          eyesOutter: 0.82,\n          box: 0.60\n        }\n        break;\n    }\n  }\n  loop () {\n    console.log('19')\n    this.canvas = this.faceapi.createCanvasFromMedia(this.video)\n    console.log('20')\n\n    console.log('iniciando canvas')\n\n    this.canvas.style.position = 'absolute'\n    this.canvas.style.left = 0\n    this.canvas.style.top = 0\n\n    this.videoWrapper.append(this.canvas)\n    console.log('21')\n    const faceapiConfig = {\n      width: this.config.width,\n      height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n    }\n    console.log('22')\n    this.faceapi.matchDimensions(this.canvas, faceapiConfig)\n    console.log('23')\n    this.boxesWidth = this.responsiveFrameBoxEyesOutterWidth(window.innerWidth)\n\n    console.log('24')\n\n    if (this.configFrameBox) this.boxesWidth = this.configFrameBox\n\n    console.log('25')\n    const frameBox = {\n      width: Math.floor(this.config.width * this.boxesWidth.box),\n      height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n    }\n    console.log('26')\n    if (this.configFrameBox?.height) {\n      frameBox.height = this.configFrameBox.height\n    }\n    frameBox.left = Math.floor((this.canvas.width / 2) - (frameBox.width / 2))\n    frameBox.top = Math.floor( (this.videoWrapper.clientHeight / 2) - (frameBox.height / 2)  )\n\n    console.log('27')\n    const height = frameBox.height + this.configEyesBoxHeight\n    const eyesOutter = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesOutter)),\n      height: Math.floor((height / 5))\n    }\n    eyesOutter.left = Math.floor((frameBox.left + (frameBox.width / 1.95) - (eyesOutter.width / 1.95)))\n    eyesOutter.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n\n    console.log('28')\n    const eyesInner = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesInner)),\n      height: Math.floor((height / 5))\n    }\n    console.log('29')\n    eyesInner.left = Math.floor((frameBox.left + (frameBox.width / 1.96) - (eyesInner.width / 1.96)))\n    eyesInner.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n\n    console.log('30')\n    this.ellipseMaskWidth = frameBox.width / 2 \n    this.ellipseMaskHeight = frameBox.height / 2.5\n    this.ellipseMaskTop = (frameBox.top + frameBox.height) / 1.9\n    this.ellipseMaskLeft = eyesOutter.left + (eyesOutter.width / 2)\n    this.ellipseMaskLineWidth = 2\n    this.createMessageBox()\n    console.log('31')\n\n    const ctx = this.canvas.getContext('2d')\n    console.log('32')\n    ctx.translate(this.canvas.width, 0)\n    ctx.scale(-1, 1)\n    this.drawEllipse(ctx)\n    console.log('33')\n    // DEBUG\n    if (this.config.isDebug) {\n      console.log('34')\n      this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n    }\n\n    console.log('35')\n    if (!this.isMobile()) {\n      this.timerBackground = setInterval(() => {\n        this.checkBackground()\n      }, 1000);\n    } else this.isBackgroundOK = true\n\n    \n    const state = {\n      counter: 0,\n      inProgress: false,\n      done: false\n    }\n    \n    const canvasPosition = this.canvas.getBoundingClientRect()\n    console.log('51')\n    this.timer = setInterval(async () => {\n      if (!navigator.onLine) {\n        console.log('52')\n        this.setHasNoNetwork()\n        console.log('53')\n        return\n      }\n      if (state.inProgress || state.done) {\n        return\n      }\n      state.inProgress = true\n\n      console.log('54')\n      const detections = await this.faceapi.detectSingleFace(this.video, new this.faceapi.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceExpressions()\n\n        console.log('55')\n      \n      this.removeLoading()\n\n      console.log('56')\n      const limitCounterFaceDiscovery = this.timeToDetectFace / this.facetimeInterval\n      if (this.showNotFoundModal && this.counterNotFoundFace > limitCounterFaceDiscovery) {\n        this.toggleModalFaceNotFound()\n      }\n\n      console.log('57')\n      if (!detections) {\n        this.blockMask('Face não encontrada', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n        state.counter = 0\n        state.inProgress = false\n        this.counterNotFoundFace++\n        return\n      } else this.counterNotFoundFace = 0\n\n      console.log('58')\n      const resizedDetections = this.faceapi.resizeResults(detections, {\n        width: this.config.width,\n        height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n      })\n\n      if (resizedDetections && resizedDetections.expressions && this.shouldCheckNeutralFace) {  \n        const expression = this.getExpression(resizedDetections.expressions)\n        if (expression !== 'neutral') {\n          if (this.config.isDebug) {\n            this.blockMask(`Mantenha expressão neutra >> ${expression}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Mantenha expressão neutra', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n      }\n      \n      if (resizedDetections.detection) {\n\n        // POSE\n        const pose = this.getPose(resizedDetections)\n        if (pose !== 'front') {\n          if (this.config.isDebug) {\n            this.blockMask(`Centralize seu rosto >> ${pose}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // ANGLE\n        const jaw = resizedDetections.landmarks.getJawOutline()\n        const rotated = this.isRotatedFace(jaw[0], jaw[16])\n        if (rotated) {\n          if (this.config.isDebug) {\n            this.blockMask('Centralize seu rosto >> rotacionado', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // DEBUG\n        if (this.config.isDebug) {\n          this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n          ctx.beginPath()\n          ctx.lineWidth = '5'\n          ctx.strokeStyle = '#FFFF00'\n          ctx.moveTo(jaw[0].x, jaw[0].y)\n          ctx.lineTo(jaw[16].x, jaw[16].y)\n          ctx.stroke()\n        }\n\n\n        const leftEye = {\n          meanPosition: [jaw[0].x, jaw[0].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n        const rightEye = { \n          meanPosition: [jaw[16].x, jaw[16].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n\n        leftEye.frameBox.isInside = this.isInside(leftEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n        rightEye.frameBox.isInside = this.isInside(rightEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n\n        leftEye.outterBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n        rightEye.outterBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n\n        leftEye.innerBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n        rightEye.innerBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n\n\n        if (!this.isBackgroundOK) {\n          this.blockMask('O ambiente está escuro', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.frameBox.isInside || !rightEye.frameBox.isInside) {\n          this.blockMask('Posicione seu rosto dentro da moldura', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.outterBox.isInside || !rightEye.outterBox.isInside) {\n          this.blockMask('Afaste seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (leftEye.innerBox.isInside || rightEye.innerBox.isInside) {\n          this.blockMask('Aproxime seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        this.ellipseMaskLineWidth *= 2\n        this.activateEllipseMask()\n    \n        state.counter += 1\n        state.inProgress = false\n        if (state.counter >= 2) {\n          state.done = true\n          this.takePicture()\n          clearInterval(this.timer)\n          !!this.timerBackground && clearInterval(this.timerBackground)\n        }\n      }\n      \n    }, this.facetimeInterval)\n  }\n\n  activateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.drawEllipse(ctx, this.activatedEllipseStrokeStyle)\n  }\n\n  deactivateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.ellipseMaskLineWidth = 3\n    this.drawEllipse(ctx)\n  }\n  \n  draw (ctx, canvas, frameBox, eyesInner, eyesOutter) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.beginPath()\n    ctx.lineWidth = 3\n    ctx.strokeStyle = 'blue'\n    ctx.rect(frameBox.left, frameBox.top, frameBox.width, frameBox.height)\n    ctx.stroke()\n\n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'yellow'\n    ctx.rect(eyesInner.left, eyesInner.top, eyesInner.width, eyesInner.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'red'\n    ctx.rect(eyesOutter.left, eyesOutter.top, eyesOutter.width, eyesOutter.height)\n    ctx.stroke()\n    this.drawEllipse(ctx)\n  }\n\n\n  drawEllipse(ctx, style) {\n    console.log('drawEllipse')\n    const x = this.ellipseMaskLeft\n    const y = this.ellipseMaskTop\n    const w = this.ellipseMaskWidth\n    const h = this.ellipseMaskHeight\n\n    ctx.beginPath()\n    ctx.lineWidth = this.ellipseMaskLineWidth\n\n    ctx.ellipse(x, y, w, h, 0, 0, Math.PI * 2)\n    ctx.strokeStyle = style || this.ellipseStrokeStyleDefault\n\n    ctx.stroke();\n  }\n  getExpression (expressions) {\n    const expArr = []\n    for (const [key, value] of Object.entries(expressions)) {\n      expArr.push({ expression: key, confidence: value })\n    }\n    const exp = expArr.sort((a, b) => a.confidence - b.confidence).pop()\n    return (exp && exp.expression) ? exp.expression : null\n  }\n  getPose(res) {\n    const eye_right = this.getMeanPosition(res.landmarks.getRightEye())\n    const eye_left = this.getMeanPosition(res.landmarks.getLeftEye())\n    const nose = this.getMeanPosition(res.landmarks.getNose())\n    const mouth = this.getMeanPosition(res.landmarks.getMouth())\n    const jaw = this.getTop(res.landmarks.getJawOutline())\n    const rx = (jaw - mouth[1]) / res.detection.box.height + 0.45\n    const ry = (eye_left[0] + (eye_right[0] - eye_left[0]) / 2 - nose[0]) / res.detection.box.width\n    let state = 'undetected'\n\n    if (res.detection.score > 0.3) {\n      state = 'front'\n      if (rx > 0.2) {\n        state = 'top'\n      } else if (rx < -0.1) {\n        state = 'bottom'\n      } else {\n        if (ry < -0.04) {\n          state = 'left'\n        }\n        if (ry > 0.04) {\n          state = 'right'\n        }\n      }\n    }\n    return state\n  }\n  isRotatedFace (p1, p2) {\n    const angleDeg = Math.abs(Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI)\n    return angleDeg > 7\n  }\n  getMeanPosition (l) {\n    return l\n      .map((a) => [a.x, a.y])\n      .reduce((a, b) => [a[0] + b[0], a[1] + b[1]])\n      .map((a) => a / l.length)\n  }\n  getTop (l) {\n    return l\n      .map((a) => a.y)\n      .reduce((a, b) => Math.min(a, b))\n  }\n  isInside (a = [], b = {}) {\n    if (a[1] < b.top) {\n      return false\n    }\n    if (a[0] < b.left) {\n      return false\n    }\n    if (a[1] > b.top + b.height) {\n      return false\n    }\n    if (a[0] > b.left + b.width) {\n      return false\n    }\n    return true\n  }\n  blockMask (message, canvasPosition, left, top, height, width) {\n    const MASK_WHITE_BORDER = 50\n    const dimensions = {\n      width: 230,\n      height: 35\n    }\n    dimensions.top = top + height + 20\n    dimensions.left = (left + (width / 2)) - (dimensions.width / 2)\n\n\n    this.deactivateEllipseMask()\n\n    this.msg.innerHTML = ''\n    const elMessage = document.createElement('span')\n    elMessage.textContent = message\n    elMessage.style = \n    `\n      display: flex;\n      color: ${this.boxMessageTextColor};\n      font-size: 1.1rem;\n      padding: 10px 20px;\n      text-align: center;\n      align-items: center;\n      background: ${this.boxMessageBackgroundColor};\n      border-radius: 7px;\n      justify-content: center;\n      width: ${dimensions.width}px;\n      font-family: Prompt, sans-serif;\n    `\n    this.msg.style.display = 'flex'\n    this.msg.appendChild(elMessage)\n  }\n  takePicture () {\n    const context = this.canvasBackground.getContext('2d')\n    this.canvasBackground.style.display = 'none;'\n    this.createFlashMask()\n    context.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    context.fillStyle = \"rgb(71,84,68)\"\n    context.fillRect(20, 50, 1, 1)\n    context.fillStyle = \"rgb(211,190,124)\"\n    context.fillRect(422, 522, 1, 1)\n    const pictureData = context.getImageData(0,0,this.canvasBackground.width,this.canvasBackground.height)\n    context.putImageData(pictureData, 0, 0)\n    this.base64 = this.canvasBackground.toDataURL('image/png')\n\n    setTimeout(() => {\n      this.removeFlashMask()\n\n      if(this.isShowPreview) {\n        this.openPreviewModal()\n      }\n      else {\n        this.confirmPicture()\n      }\n      \n    }, 300)\n  }\n  checkBackground () {\n    this.canvasLuminance = document.createElement('canvas')\n    const width = this.videoWrapper.clientWidth / 2\n    const height = this.videoWrapper.clientHeight / 2\n\n    const context = this.canvasLuminance.getContext('2d')\n\n    context.drawImage(this.video, 0, 0, this.canvasLuminance.width, this.canvasLuminance.height)\n    const pictureData = context.getImageData(0,0,this.canvasLuminance.width,this.canvasLuminance.height)\n    this.sweepVideo(pictureData.data)\n\n    this.isBackgroundOK = (this.brightness >= this.brightnessControl && this.luminance >= this.luminanceControl)\n\n    if (this.config.isDebug) {\n      const table = {\n        brilho: {\n          atual: this.brightness,\n          'mín aceitável': this.brightnessControl,\n        },\n        'luminância': {\n          atual: parseFloat(this.luminance.toFixed(2)),\n          'mín aceitável': this.luminanceControl\n        }\n      }\n      console.table(table)\n    }\n  }\n  createFlashMask () {\n    const flash = document.createElement('div')\n    flash.style.width = '100%'\n    flash.style.height = '100vh'\n    flash.style.position = 'fixed'\n    flash.style.background = 'white'\n    flash.style.zIndex = 999\n    flash.style.top = 0\n    flash.style.left = 0\n    flash.id = 'flash'\n    document.body.append(flash)\n  }\n  removeFlashMask () {\n    const flash = document.getElementById('flash')\n    flash.remove()\n  }\n  createMessageBox () {\n    const box = document.getElementById('liveness-box-message')\n    if (!!box) box.remove()\n    this.msg = document.createElement('div')\n    this.msg.id = 'liveness-box-message'\n    this.msg.style = `\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      z-index: 999;\n      background: transparent;\n      position: absolute;\n      top: ${this.ellipseMaskTop + this.ellipseMaskHeight}px;\n    `\n    this.videoWrapper.append(this.msg)\n    return this\n  }\n  toggleModalFaceNotFound () {\n    const hasModal = document.getElementById('modal-liveness-face-not-found')\n    if (!!hasModal) return\n\n    const modalWrapper = document.createElement('div')\n    modalWrapper.id = 'modal-liveness-face-not-found'\n    modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 21;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    display: grid;\n    align-items: flex-start;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n\n    const modalFaceNotFound = document.createElement('div')\n    modalFaceNotFound.style = `\n    gap: 10px;\n    margin-top: 50px;\n    padding: 15px 10px;\n    display: grid;\n    background: white;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    font-family: Prompt, sans-serif;\n    `\n    modalFaceNotFound.innerHTML = \n    `\n      <h3>Atenção</h3>\n      <p style=\"width: 100%\">Não foi possível realizar a captura, tente novamente:</p>\n      <ul style=\"width: 100%; display: grid; gap: 5px;\">\n        <li>Em um fundo neutro, de preferência com uma parede clara</li>\n        <li>Em um ambiente com iluminação neutra (nem muito claro nem muito escuro)</li>\n        <li>Removendo os adereços que prejudiquem a visualização da sua face, como cachecol, tocas, bonés e fones</li>\n      </ul>\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = 'OK'\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 130px;\n    height: 30px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    z-index: 1;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    justify-content: center;\n    `\n    footer.append(confirmButton)\n    modalFaceNotFound.append(footer)\n    modalWrapper.append(modalFaceNotFound)\n    confirmButton.addEventListener('click', () => {\n      this.counterNotFoundFace = 0\n      const modal = document.getElementById('modal-liveness-face-not-found')\n      if (!!modal) {\n        modal.remove()\n      }\n    })\n    document.body.append(modalWrapper)\n\n    return this\n  }\n  createModalConfirmationWrapper () {\n    this.modalWrapper = document.createElement('div')\n    this.modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 999;\n    width: ${this.videoWrapper.style.width};\n    height: ${this.videoWrapper.style.height};\n    display: none;\n    position: fixed;\n    align-items: flex-start;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n    this.modalWrapper.id = 'modalWrapper'\n    document.body.append(this.modalWrapper)\n    return this\n  }\n  createModalConfirmation () {\n    this.modalConfirmation = document.createElement('div')\n    this.modalConfirmation.style = `\n    padding: 7px;\n    display: flex;\n    width: ${this.videoWrapper.style.width};\n    height: ${this.videoWrapper.style.height};\n    background: white;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = 'Confirmar'\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const cancelButton = document.createElement('button')\n    cancelButton.textContent = 'Cancelar'\n    cancelButton.style = `\n    color: #444;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    position: absolute;\n    justify-content: center;\n    `\n    footer.append(cancelButton)\n    footer.append(confirmButton)\n    this.modalConfirmation.append(footer)\n    this.modalWrapper.append(this.modalConfirmation)\n    confirmButton.addEventListener('click', () => {\n      this.closePreviewModal()\n      this.confirmPicture()\n    })\n    cancelButton.addEventListener('click', () => {\n      this.cancelPicture()\n    })\n    return this\n  }\n\n  openPreviewModal () {\n    const image = document.createElement('img')\n    image.src = this.base64\n    image.style = `\n    width: 100%;\n    height: 100%;\n    max-width: ${this.videoWrapper.clientWidth};\n    object-fit: cover;\n    border-radius: 7px;\n    transform: scaleX(-1);\n    `\n    this.modalConfirmation.append(image)\n    this.modalWrapper.style.display = 'flex'\n  }\n\n  closePreviewModal () {\n    const modal = document.getElementById('modalWrapper')\n    if (modal) modal.remove()\n  }\n\n  cancelPicture () {\n    this.resetLiveness()\n  }\n\n  downloadImage () {\n    const anchor = createElement('a')\n    anchor.setAttribute('download', 'image.png')\n    anchor.setAttribute('href', this.base64)\n    anchor.click()\n    setTimeout(() => {\n      anchor.remove()\n    }, 1000);\n  }\n\n  setLoading () {\n    console.log('setLoading')\n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n        <div id=\"spinner-message\" />\n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        #spinner-message {\n          width: 100%;\n          display: flex;\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  setLoadingProgress () { \n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n    const spinner = `<div id=\"spinner\">\n        <p class=\"liveness-progress-text\">\n          ${\n            this.uploadInProgress === 100\n            ? '<strong>Aguarde enquanto estamos <br /> analisando a sua selfie</strong>'\n            : `Fazendo upload da selfie...<br /> (${this.uploadInProgress?.toFixed(0)}% enviados)`\n          }\n        </p>\n    \n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        .liveness-progress-text {\n          color: white;\n          text-align: center;\n        }\n        .liveness-progress-text strong {\n          opacity: 1;\n          animation: blink-text 1s ease infinite alternate;\n        }\n        @keyframes blink-text {\n          from {\n            opacity: 1;\n          }\n          to {\n            opacity: 0.4;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  getTips () {\n    const tips = []\n\n    tips.push(`Tamanho do video: ${this.videoWrapper.style.width} x ${this.videoWrapper.style.height}. Tamanho enviado para a API: ${this.canvasBackground.width}px x ${this.canvasBackground.height}px`)\n\n    const calcAspectRatio = this.canvasBackground.width / this.canvasBackground.height\n    if (calcAspectRatio.toFixed(2) !== '1.33') {\n      tips.push('A imagem não está com a proporção adequada. Tente a proporção 4/3 | Por ex.: 640x480, 800x600, 960x720 ou 1024x768')\n    }\n    if (!this.isMobile() && this.canvasBackground.width <= 320) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 3`)\n    }\n\n    if (!this.isMobile() && this.canvasBackground.width > 320 && this.canvasBackground.width <= 515) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 2`)\n    }\n\n    if (!this.isMobile() && this.canvasBackground.width > 515 && this.canvasBackground.width < 700) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 1.5`)\n    }\n    return tips.join(', ')\n  }\n\n  removeLoading () {\n    console.log('removeLoading')\n    const spinner = document.getElementById('spinner')\n    if(spinner) spinner.remove()\n  }\n\n  setHasNoNetwork () {\n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n        <p>Estamos sem conexão<br />com a internet</p>\n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        #spinner p {\n          color: white;\n          text-align: center;\n          animation: blink 1s linear infinite;\n        }\n\n        @keyframes blink {\n          0% {\n            opacity: 1;\n          }\n          100% {\n            opacity: 0.2;\n          }\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  async sendPictureByXmlRequest () {\n    const endpoint = `${this.livenessUrlBase}${this.livenessConfirmEndpoint}`\n    const xhr = new XMLHttpRequest()\n    xhr.open('POST', endpoint, true)\n\n    xhr.setRequestHeader('Authorization', `Bearer ${this.token}`)\n\n    xhr.upload.addEventListener('progress', (e) => {\n      this.uploadInProgress  = (e.loaded / e.total) * 100\n\n      this.removeLoading()\n      this.setLoadingProgress()\n    })\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === XMLHttpRequest.DONE) {\n        const response = JSON.parse(xhr?.response)\n\n        if (!response?.data?.isAlive) response.tips = this.getTips()\n\n        switch (xhr.status) {\n          case 200:\n            this.successCallback({...response, base64: this.base64})\n            break;\n          case 401:\n            this.errorCallback({ error: response, base64: this.base64})\n            break;\n          default:\n            this.errorCallback({ error: response, base64: this.base64})\n            break;\n        }\n        this.resetLiveness()\n        this.removeLoading()\n      }\n    }\n    if (this.requestType === 'b64') {\n      await this.sendBase64(xhr)\n    } else {\n      await this.sendFormData(xhr)\n    }\n  }\n\n  async sendBase64 (xhr) {\n    xhr.setRequestHeader('Content-Type', 'application/json')\n    xhr.send(JSON.stringify({\n      base64: {\n        key: this.toB64()\n      }\n    }))\n  }\n  async sendFormData (xhr) {\n    const formData = await this.toFormData()\n    xhr.send(formData)\n  }\n  async toFormData () {\n    const formData = new FormData()\n    const responseFetch = await fetch(this.base64)\n    const blob = await responseFetch.blob()\n    formData.append('selfie', blob, 'image.png')\n    return formData\n  }\n\n  toB64 () {\n    const base64Local = this.base64\n    return base64Local.split(',')[1]\n  }\n\n  confirmPicture () {\n    try {\n      this.sendPictureByXmlRequest()\n    } catch (error) {\n      this.errorCallback({ error, base64: this.base64})\n    }\n  }\n}\n\nmodule.exports = Liveness\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(515);\n"],"sourceRoot":""}