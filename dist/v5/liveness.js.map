{"version":3,"sources":["webpack://Liveness/./src/Livenessv5.js","webpack://Liveness/webpack/bootstrap","webpack://Liveness/webpack/startup"],"names":["module","exports","constructor","videoWrapper","config","windowWidth","window","innerWidth","width","height","Math","floor","this","token","faceapi","cssOrientationStyle","document","createElement","innerText","cssOrientationLock","head","appendChild","brightnessControl","luminanceControl","faceapiPath","isShowPreview","errorCallback","successCallback","livenessUrlBase","displaySize","livenessConfirmEndpoint","setMinBrightness","value","setMinLuminance","setLiveness","loadFaceApi","setLoading","createModalConfirmationWrapper","createModalConfirmation","createVideoElement","startVideo","createCanvasBackground","resetLiveness","removeCanvas","resetVideoWrapper","closePreviewModal","base64","removeLoading","canvasBackground","style","display","sweepVideo","data","luminanceAvg","brightnessSum","luminanceArray","x","length","r","g","b","sweepBrightness","sweepLuminance","checkBrightness","brightness","calcLuminance","push","luminance","colorFactor","colorArray","i","pow","script","faceJS","src","append","onload","async","loadFaceApiModels","setTimeout","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","undefined","navigator","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","Promise","resolve","reject","call","Error","video","then","stream","querySelector","srcObject","URL","createObjectURL","catch","err","console","error","transform","setAttribute","position","setVideoMask","addEventListener","createMessageBox","loop","getElementById","innerHTML","canvas","getElementsByTagName","remove","insertAdjacentHTML","createMask","maskEllipse","svgMask","includes","clientWidth","createCanvasFromMedia","left","top","matchDimensions","frameBox","eyesOutter","eyesInner","ctx","getContext","translate","scale","isDebug","draw","canvasPosition","getBoundingClientRect","state","counter","inProgress","done","timerBackground","setInterval","checkBackground","timer","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","blockMask","resizedDetections","resizeResults","expressions","expression","getExpression","detection","pose","getPose","jaw","landmarks","getJawOutline","isRotatedFace","beginPath","lineWidth","strokeStyle","moveTo","y","lineTo","stroke","leftEye","meanPosition","isInside","outterBox","innerBox","rightEye","isBackgroundOK","msg","activateEllipseMask","takePicture","clearInterval","deactivateEllipseMask","clearRect","rect","expArr","key","Object","entries","confidence","exp","sort","a","pop","res","eye_right","getMeanPosition","getRightEye","eye_left","getLeftEye","nose","getNose","mouth","getMouth","rx","getTop","box","ry","score","p1","p2","abs","atan2","PI","l","map","reduce","min","message","dimensions","textContent","context","drawImage","toDataURL","openPreviewModal","confirmPicture","pictureData","getImageData","table","brilho","atual","parseFloat","toFixed","modalWrapper","id","body","modalConfirmation","confirmButton","cancelButton","footer","cancelPicture","image","modal","spinner","requestOptions","method","headers","JSON","stringify","replace","endpoint","fetch","response","json","result","statusCode","alert","finally","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"liveness.js","sourcesContent":["\"use strict\";\nclass Liveness {\n\n  constructor (videoWrapper, config) {\n    const HORIZONTAL_PADDING = 20\n    const windowWidth = window.innerWidth\n    if (config.width >= windowWidth) {\n      config.width = (windowWidth - HORIZONTAL_PADDING)\n    }\n\n    config.height = Math.floor(config.width * 0.7778)\n    this.config = config\n    this.token = config.token\n    this.videoWrapper = videoWrapper\n    this.faceapi = null\n\n    const cssOrientationStyle = document.createElement('style')\n    cssOrientationStyle.innerText = this.cssOrientationLock()\n    document.head.appendChild(cssOrientationStyle)\n    \n    if (config.brightnessControl) this.brightnessControl = config.brightnessControl\n    else this.brightnessControl = 108\n\n    if (config.luminanceControl) this.luminanceControl = config.luminanceControl\n    else this.luminanceControl = 23\n\n    this.faceapiPath = config.faceapiPath\n    this.isShowPreview = config.isShowPreview\n    this.errorCallback = config.errorCallback\n    this.successCallback = config.successCallback\n    this.livenessUrlBase = config.livenessUrlBase\n    this.displaySize = { width: config.width, height: config.height }\n    this.livenessConfirmEndpoint = config.livenessConfirmEndpoint || '/liveness/v2'\n  }\n\n  setMinBrightness (value) {\n    this.brightnessControl = value\n  }\n  setMinLuminance (value) {\n    this.luminanceControl = value\n  }\n\n  async start () {\n    if (!window.faceapi) {\n      await this.loadFaceApi()\n    } else {\n      this.faceapi = window.faceapi\n      this.setLiveness()\n    }\n  }\n\n  setLiveness () {\n    this.setLoading()\n    this.createModalConfirmationWrapper()\n    .createModalConfirmation()\n    .createVideoElement()\n    .startVideo()\n    .createCanvasBackground()\n  }\n  resetLiveness () {\n    this.removeCanvas()\n    this.resetVideoWrapper()\n    this.closePreviewModal()\n    this.base64 = ''\n    this.removeLoading()\n    this.setLiveness()\n  }\n\n  cssOrientationLock () {\n    return '@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) { html { transform: rotate(-90deg);transform-origin: left top;width: 100vh;overflow-x: hidden;position: absolute;top: 100%;left: 0;}}'\n  }\n\n  createCanvasBackground () {\n    this.canvasBackground = document.createElement('canvas')\n    this.canvasBackground.width = 720\n    this.canvasBackground.height = 560\n    this.canvasBackground.style.display = 'none'\n  }\n\n  sweepVideo (data) {\n    this.luminanceAvg = 0\n    this.brightnessSum = 0 \n    this.luminanceArray = []\n\n    for (let x = 0; x < data.length; x += 4) {\n      const r = data[x]\n      const g = data[x + 1]\n      const b = data[x + 2]\n      this.sweepBrightness(r, g, b)\n      this.sweepLuminance(r, g, b)\n    }\n    this.checkBrightness()\n  }\n\n  checkBrightness () {\n    this.brightness = Math.floor(this.brightnessSum / (this.canvasBackground.width * this.canvasBackground.height))\n  }\n\n  sweepBrightness (r, g, b) {\n    this.brightnessSum += Math.floor((r + g + b) / 3)\n  }\n\n  sweepLuminance (r, g, b) {\n    this.luminanceAvg += this.calcLuminance(r, g, b)\n    this.luminanceArray.push(this.calcLuminance(r, g, b))     \n\n    this.luminance = (this.luminanceAvg / this.luminanceArray?.length) * 100\n  }\n\n  calcLuminance (r, g, b) {\n    let colorArray = [r, g, b]\n    let colorFactor\n    for (let i = 0; i < colorArray.length; i++) {\n        colorFactor = colorArray[i] / 255\n        if (colorFactor <= 0.03928) {\n            colorFactor = colorFactor / 12.92\n        } else {\n            colorFactor = Math.pow(((colorFactor + 0.055) / 1.055), 2.4)\n        }\n        colorArray[i] = colorFactor\n    }\n    return (colorArray[0] * 0.2126 + colorArray[1] * 0.7152 + colorArray[2] * 0.0722) + 0.05\n  }\n\n\n  async loadFaceApi () {\n    const script = document.createElement('script')\n    const faceJS = `${this.faceapiPath}/face-api.min.js`\n    script.src = faceJS\n    document.head.append(script)\n    script.onload = async () => {\n      await this.loadFaceApiModels()\n    }\n    return this\n  }\n  async loadFaceApiModels () {\n    setTimeout(async () => {\n      await faceapi.nets.tinyFaceDetector.loadFromUri(this.faceapiPath)\n      await faceapi.nets.faceLandmark68Net.loadFromUri(this.faceapiPath)\n      await faceapi.nets.faceRecognitionNet.loadFromUri(this.faceapiPath)\n      await faceapi.nets.faceExpressionNet.loadFromUri(this.faceapiPath)\n      this.faceapi = faceapi\n      this.setLiveness()\n    }, 1000)\n    return this\n  }\n\n  startVideo () {\n    if (navigator.mediaDevices === undefined) {\n      navigator.mediaDevices = {}\n    }\n    if (navigator.mediaDevices.getUserMedia === undefined) {\n      navigator.mediaDevices.getUserMedia = function(constraints) {\n        const getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n        if (!getUserMedia) {\n          return Promise.reject(new Error('getUserMedia não implementado nesse browser'))\n        }\n        return new Promise(function(resolve, reject) {\n          getUserMedia.call(navigator, constraints, resolve, reject)\n        })\n      }\n    }\n    navigator.mediaDevices.getUserMedia({\n        video: {          \n          width: this.config.width,\n          height: this.config.height\n        }\n      }).then((stream) => {\n        const video = document.querySelector('video')\n        if (\"srcObject\" in video) {\n          video.srcObject = stream\n        } else {\n          video.src = window.URL.createObjectURL(stream)\n        }\n      }).catch(err => console.error(err))\n    return this\n  }\n  createVideoElement () {\n    this.video = document.createElement('video')\n    this.video.style.width = this.config.width\n    this.video.style.height = this.config.height\n    this.video.style.transform = 'scaleX(-1)'\n    this.video.setAttribute('muted', true)\n    this.video.setAttribute('autoplay', true)\n    this.videoWrapper.style.position = 'relative'\n    this.videoWrapper.style.width = this.config.width\n    this.videoWrapper.style.height = this.config.height\n    this.videoWrapper.append(this.video)\n    this.setVideoMask()\n    this.video.addEventListener('play', () => {\n      this.createMessageBox()\n      this.loop()\n    })\n    return this\n  }\n  resetVideoWrapper () {\n    const videoWrapper = document.getElementById('video-wrapper')\n    if(videoWrapper) videoWrapper.innerHTML = ''\n  }\n\n  removeCanvas () {\n    const canvas = document.getElementsByTagName('canvas')[0]\n    if(canvas) canvas.remove()\n  }\n\n  setVideoMask () {\n    this.videoWrapper.insertAdjacentHTML('beforeend', this.createMask())\n    this.maskEllipse = document.getElementById('mask-ellipse')\n    this.svgMask = document.getElementById('svg-mask')\n    this.svgMask.style.width = this.config.width\n    this.svgMask.style.height = this.config.height\n\n  }\n  createMask () {\n    return `<svg\n    id=\"svg-mask\"\n    style=\"display: none;\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n    viewBox=\"0 0 720 560\"\n  >\n    <path\n      id=\"mask-ellipse\"\n      d=\"M507.5 275C507.5 332.25 490.842 383.977 464.035 421.328C437.225 458.683 400.41 481.5 360 481.5C319.59 481.5 282.775 458.683 255.965 421.328C229.158 383.977 212.5 332.25 212.5 275C212.5 217.75 229.158 166.023 255.965 128.672C282.775 91.3174 319.59 68.5 360 68.5C400.41 68.5 437.225 91.3174 464.035 128.672C490.842 166.023 507.5 217.75 507.5 275Z\"\n      stroke=\"#B40000\"\n      stroke-width=\"5\"\n    />\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M21 10C15.4772 10 11 14.4772 11 20V542C11 547.523 15.4771 552 21 552H698C703.523 552 708 547.523 708 542V20C708 14.4772 703.523 10 698 10H21ZM360 481C441.186 481 507 388.771 507 275C507 161.229 441.186 69 360 69C278.814 69 213 161.229 213 275C213 388.771 278.814 481 360 481Z\"\n      fill=\"#000\"\n      fill-opacity=\"0.6\"\n    />\n    <rect\n      x=\"12.5\"\n      y=\"12.5\"\n      width=\"695\"\n      height=\"535\"\n      stroke=\"white\"\n      stroke-width=\"25\"\n    />\n  </svg>`\n  }\n  loop () {\n    if (this.video.style.width.includes('%')) {\n      this.displaySize.width = this.video.style.width =this.video.clientWidth\n    }\n    this.canvas = this.faceapi.createCanvasFromMedia(this.video)\n\n    this.canvas.style.position = 'absolute'\n    this.canvas.style.left = 0\n    this.canvas.style.top = 8\n\n    this.canvas.style.width = this.videoWrapper.style.width\n    this.canvas.style.height = this.videoWrapper.style.height\n\n    this.videoWrapper.append(this.canvas)\n\n    this.faceapi.matchDimensions(this.canvas, this.displaySize)\n    this.svgMask.setAttribute('style', 'display: block; position:absolute; top: 0; left: 0;')\n    this.maskEllipse.setAttribute('style', 'display: block;')\n    \n    const frameBox = {\n      width: Math.floor(this.config.width * .515),\n      height: Math.floor(this.config.height * .922)\n    }\n    frameBox.left = Math.floor((this.canvas.width / 2) - (frameBox.width / 2))\n    frameBox.top = Math.floor((this.canvas.height - frameBox.height) / 2.25)\n    const eyesOutter = {\n      width: Math.floor((frameBox.width * 0.8)),\n      height: Math.floor((frameBox.height / 5))\n    }\n    eyesOutter.left = Math.floor((frameBox.left + (frameBox.width / 1.95) - (eyesOutter.width / 1.95)))\n    eyesOutter.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n    const eyesInner = {\n      width: Math.floor((frameBox.width * 0.68)),\n      height: Math.floor((frameBox.height / 5))\n    }\n    eyesInner.left = Math.floor((frameBox.left + (frameBox.width / 1.96) - (eyesInner.width / 1.96)))\n    eyesInner.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n\n    const ctx = this.canvas.getContext('2d')\n    ctx.translate(this.canvas.width, 0)\n    ctx.scale(-1, 1)\n\n    // DEBUG\n    if (this.config.isDebug) {\n      this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n    }\n\n    const canvasPosition = this.canvas.getBoundingClientRect()\n    const state = {\n      counter: 0,\n      inProgress: false,\n      done: false\n    }\n\n    const timerBackground = setInterval(() => {\n      this.checkBackground()\n    }, 1000);\n\n    const timer = setInterval(async () => {\n      if (state.inProgress || state.done) {\n        return\n      }\n      state.inProgress = true\n\n      const detections = await this.faceapi.detectSingleFace(this.video, new this.faceapi.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceExpressions()\n\n      this.removeLoading()\n\n      if (!detections) {\n        this.blockMask('Face não encontrada', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n        state.counter = 0\n        state.inProgress = false\n        return\n      }\n\n      const resizedDetections = this.faceapi.resizeResults(detections, this.displaySize)\n\n      if (resizedDetections && resizedDetections.expressions) {  \n        const expression = this.getExpression(resizedDetections.expressions)\n        if (expression !== 'neutral') {\n          if (this.config.isDebug) {\n            this.blockMask(`Mantenha expressão neutra >> ${expression}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Mantenha expressão neutra', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n      }\n      \n      if (resizedDetections.detection) {\n\n        // POSE\n        const pose = this.getPose(resizedDetections)\n        if (pose !== 'front') {\n          if (this.config.isDebug) {\n            this.blockMask(`Centralize seu rosto >> ${pose}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // ANGLE\n        const jaw = resizedDetections.landmarks.getJawOutline()\n        const rotated = this.isRotatedFace(jaw[0], jaw[16])\n        if (rotated) {\n          if (this.config.isDebug) {\n            this.blockMask('Centralize seu rosto >> rotacionado', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // DEBUG\n        if (this.config.isDebug) {\n          this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n          ctx.beginPath()\n          ctx.lineWidth = '5'\n          ctx.strokeStyle = 'green'\n          ctx.moveTo(jaw[0].x, jaw[0].y)\n          ctx.lineTo(jaw[16].x, jaw[16].y)\n          ctx.stroke()\n        }\n\n\n        const leftEye = {\n          meanPosition: [jaw[0].x, jaw[0].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n        const rightEye = { \n          meanPosition: [jaw[16].x, jaw[16].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n\n        leftEye.frameBox.isInside = this.isInside(leftEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n        rightEye.frameBox.isInside = this.isInside(rightEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n\n        leftEye.outterBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n        rightEye.outterBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n\n        leftEye.innerBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n        rightEye.innerBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n\n\n        if (!this.isBackgroundOK) {\n          this.blockMask('O ambiente está escuro', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.frameBox.isInside || !rightEye.frameBox.isInside) {\n          this.blockMask('Posicione seu rosto dentro da moldura', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.outterBox.isInside || !rightEye.outterBox.isInside) {\n          this.blockMask('Afaste seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (leftEye.innerBox.isInside || rightEye.innerBox.isInside) {\n          this.blockMask('Aproxime seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n\n        this.msg.style = 'display: none;'\n        this.activateEllipseMask()\n        state.counter += 1\n        state.inProgress = false\n        if (state.counter >= 2) {\n          state.done = true\n          this.takePicture(this.canvas)\n          clearInterval(timer)\n          clearInterval(timerBackground)\n        }\n      }\n      \n    }, 250)\n  }\n  activateEllipseMask () {\n    this.maskEllipse.setAttribute('stroke', '#0F0')\n  }\n  deactivateEllipseMask () {\n    this.maskEllipse.setAttribute('stroke', '#F00')\n  }\n  draw (ctx, canvas, frameBox, eyesInner, eyesOutter) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.beginPath()\n    ctx.lineWidth = '3'\n    ctx.strokeStyle = 'blue'\n    ctx.rect(frameBox.left, frameBox.top, frameBox.width, frameBox.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = '2'\n    ctx.strokeStyle = 'yellow'\n    ctx.rect(eyesInner.left, eyesInner.top, eyesInner.width, eyesInner.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = '2'\n    ctx.strokeStyle = 'red'\n    ctx.rect(eyesOutter.left, eyesOutter.top, eyesOutter.width, eyesOutter.height)\n    ctx.stroke()\n\n  }\n  getExpression (expressions) {\n    const expArr = []\n    for (const [key, value] of Object.entries(expressions)) {\n      expArr.push({ expression: key, confidence: value })\n    }\n    const exp = expArr.sort((a, b) => a.confidence - b.confidence).pop()\n    return (exp && exp.expression) ? exp.expression : null\n  }\n  getPose(res) {\n    const eye_right = this.getMeanPosition(res.landmarks.getRightEye())\n    const eye_left = this.getMeanPosition(res.landmarks.getLeftEye())\n    const nose = this.getMeanPosition(res.landmarks.getNose())\n    const mouth = this.getMeanPosition(res.landmarks.getMouth())\n    const jaw = this.getTop(res.landmarks.getJawOutline())\n    const rx = (jaw - mouth[1]) / res.detection.box.height + 0.45\n    const ry = (eye_left[0] + (eye_right[0] - eye_left[0]) / 2 - nose[0]) / res.detection.box.width\n    let state = 'undetected'\n\n    if (res.detection.score > 0.3) {\n      state = 'front'\n      if (rx > 0.2) {\n        state = 'top'\n      } else if (rx < -0.1) {\n        state = 'bottom'\n      } else {\n        if (ry < -0.04) {\n          state = 'left'\n        }\n        if (ry > 0.04) {\n          state = 'right'\n        }\n      }\n    }\n    return state\n  }\n  isRotatedFace (p1, p2) {\n    const angleDeg = Math.abs(Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI)\n    return angleDeg > 7\n  }\n  getMeanPosition (l) {\n    return l\n      .map((a) => [a.x, a.y])\n      .reduce((a, b) => [a[0] + b[0], a[1] + b[1]])\n      .map((a) => a / l.length)\n  }\n  getTop (l) {\n    return l\n      .map((a) => a.y)\n      .reduce((a, b) => Math.min(a, b))\n  }\n  isInside (a = [], b = {}) {\n    if (a[1] < b.top) {\n      return false\n    }\n    if (a[0] < b.left) {\n      return false\n    }\n    if (a[1] > b.top + b.height) {\n      return false\n    }\n    if (a[0] > b.left + b.width) {\n      return false\n    }\n    return true\n  }\n  blockMask (message, canvasPosition, left, top, height, width) {\n    const MASK_WHITE_BORDER = 50\n    const dimensions = {\n      width: 230,\n      height: 35\n    }\n    dimensions.top = top + height + 20\n    dimensions.left = (left + (width / 2)) - (dimensions.width / 2)\n\n    this.maskEllipse.setAttribute('stroke', '#B40000')\n    this.msg.textContent = message\n    this.msg.style = `\n      left: 50%;\n      display: flex;\n      color: #f3f3f5;\n      font-size: 1.1rem;\n      padding: 10px 20px;\n      position: absolute;\n      text-align: center;\n      align-items: center;\n      background: #D02780;\n      border-radius: 7px;\n      justify-content: center;\n      top: ${dimensions.top}px;\n      transform: translateX(-50%);\n      width: ${dimensions.width}px;\n      height: ${dimensions.height}px;\n      font-family: Prompt, sans-serif;\n    `\n  }\n  takePicture (canvas) {\n    const context = this.canvasBackground.getContext('2d')\n    this.canvasBackground.style.display = 'none;'\n    context.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    this.base64 = this.canvasBackground.toDataURL('image/png')\n\n    if(this.isShowPreview) {\n      this.openPreviewModal()\n    }\n    else {\n      this.confirmPicture()\n    }\n  }\n  checkBackground () {\n    if (!this.canvasBackground) return\n    const context = this.canvasBackground.getContext('2d')\n\n    context.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    const pictureData = context.getImageData(0,0,this.canvasBackground.width,this.canvasBackground.height)\n    this.sweepVideo(pictureData.data)\n\n    this.isBackgroundOK = (this.brightness >= this.brightnessControl && this.luminance >= this.luminanceControl)\n\n    if (this.config.isDebug) {\n      const table = {\n        brilho: {\n          atual: this.brightness,\n          'mín aceitável': this.brightnessControl,\n        },\n        'luminânia': {\n          atual: parseFloat(this.luminance.toFixed(2)),\n          'mín aceitável': this.luminanceControl\n        }\n      }\n      console.table(table)\n    }\n  }\n  createMessageBox () {\n    this.msg = document.createElement('div')\n    this.videoWrapper.append(this.msg)\n    return this\n  }\n  createModalConfirmationWrapper () {\n    this.modalWrapper = document.createElement('div')\n    this.modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 10;\n    width: 100%;\n    height: 100%;\n    display: none;\n    position: fixed;\n    align-items: center;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n    this.modalWrapper.id = 'modalWrapper'\n    document.body.append(this.modalWrapper)\n    return this\n  }\n  createModalConfirmation () {\n    this.modalConfirmation = document.createElement('div')\n    this.modalConfirmation.style = `\n    padding: 7px;\n    display: flex;\n    max-width: 720px;\n    background: white;\n    max-height: 560px;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = 'Confirmar'\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const cancelButton = document.createElement('button')\n    cancelButton.textContent = 'Cancelar'\n    cancelButton.style = `\n    color: #444;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    position: absolute;\n    justify-content: center;\n    `\n    footer.append(cancelButton)\n    footer.append(confirmButton)\n    this.modalConfirmation.append(footer)\n    this.modalWrapper.append(this.modalConfirmation)\n    confirmButton.addEventListener('click', () => {\n      this.closePreviewModal()\n      this.confirmPicture()\n    })\n    cancelButton.addEventListener('click', () => {\n      this.cancelPicture()\n    })\n    return this\n  }\n\n  openPreviewModal () {\n    const image = document.createElement('img')\n    image.src = this.base64\n    image.style = `\n      max-width: 720px;\n      min-width: 520px;\n      min-height: 360px;\n      max-height: 560px;\n      object-fit: cover;\n      border-radius: 7px;\n    `\n    this.modalConfirmation.append(image)\n    this.modalWrapper.style.display = 'flex'\n  }\n\n  closePreviewModal () {\n    const modal = document.getElementById('modalWrapper')\n    if (modal) modal.remove()\n  }\n\n  cancelPicture () {\n    this.resetLiveness()\n  }\n\n  setLoading () { \n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n        <style>\n        #spinner {\n          z-index: 40;\n          align-content: center;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n          top: 0;\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n  removeLoading () {\n    const spinner = document.getElementById('spinner')\n    if(spinner) spinner.remove()\n  }\n\n  confirmPicture () {\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.token}`\n      },\n      body: JSON.stringify({\n        base64: {\n          key: this.base64.replace('data:image/png;base64,', '')\n        }\n      })\n    }\n    this.setLoading()\n    const endpoint = `${this.livenessUrlBase}${this.livenessConfirmEndpoint}`\n    fetch(endpoint, requestOptions)\n      .then(response => response.json())\n      .then(result => {\n        if (result?.data) {\n          this.successCallback(result)\n          return\n        }\n\n        if (result?.error?.statusCode === 401) {\n          alert('Token inválido')\n          return\n        }\n\n        this.errorCallback(error)\n        console.error('error:', result?.error?.message)\n\n      })\n      .catch(error => {\n        this.errorCallback(error)\n      })\n      .finally(() => {\n        this.resetLiveness()\n        this.removeLoading()\n      })\n  }\n}\n\nmodule.exports = Liveness\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(708);\n"],"sourceRoot":""}