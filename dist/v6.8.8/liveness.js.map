{"version":3,"sources":["webpack://Liveness/./src/Livenessv6.8.8.js","webpack://Liveness/webpack/bootstrap","webpack://Liveness/webpack/startup"],"names":["module","exports","constructor","videoWrapper","config","this","uploadInProgress","requestType","counterNotFoundFace","faceapi","token","configFrameBox","frameBox","scalingFactorForLiveness","ellipseMaskWidth","ellipseMaskHeight","ellipseMaskTop","ellipseMaskLeft","mobileFacingMode","width","getFullWidth","height","getFullHeight","heightAspectRatio","isMobile","isDebug","cssOrientationStyle","document","createElement","innerText","cssOrientationLock","head","appendChild","brightnessControl","luminanceControl","faceapiPath","isShowPreview","errorCallback","successCallback","livenessUrlBase","livenessConfirmEndpoint","ellipseStrokeStyleDefault","ellipseStrokeStyle","activatedEllipseStrokeStyle","boxMessageBackgroundColor","boxMessageTextColor","configEyesBoxHeight","requestAnimationFrame","window","shouldCheckNeutralFace","facetimeInterval","timeToDetectFace","showNotFoundModal","cameraPermissionErrorCallback","ignoreFaceRules","activateCountdown","onRequestDone","onRequestUploadEnd","onRequestUploadStart","onRequestOpened","onRequestLoading","onRequestUnsent","validations","shouldAutoSendToApi","undefined","createCustomEvents","selectedLang","language","languages","pt","unmatchedFace","keepNeutralFace","centerYourFace","darkEnvironment","positionFaceWithinFrame","moveFaceAway","moveFaceCloser","moveFaceDown","moveFaceUp","moveFaceRight","moveFaceLeft","mediaNotImplemented","videoAriaLabel","countdownAriaText","countdownText","tiltedFace","faceNotFoundModalTitle","faceNotFoundModalDescription","faceNotFoundModalTopic1","faceNotFoundModalTopic2","faceNotFoundModalTopic3","modalAriaPhotoTakenSuccessfully","modalConfirmButtonText","modalCancelButtonText","progressWaitingAccessilityText","finishedUploadHTMLText","uploadInProgressHTMLText","noNetworkHTMLText","en","es","newLanguages","boxMessages","onPhotoTakenEvent","CustomEvent","onPreviewOpenEvent","onPreviewCloseEvent","onUploadStart","onUploadEnd","Math","max","body","scrollWidth","documentElement","offsetWidth","clientWidth","scrollHeight","offsetHeight","clientHeight","setUseBase64","setUseFormData","setMinBrightness","value","setMinLuminance","setMobileFaceCam","resetLiveness","setMobileEnvironmentCam","setFrameBoxesWidth","eyesInner","eyesOutter","box","setDimensionsRequestImage","dimensions","toggleDebug","canvas","getContext","clearRect","setEyesBoxHeight","pixels","stop","video","pause","stream","getTracks","forEach","track","src","srcObject","clearInterval","timer","timerBackground","setCheckNeutralFace","callback","startCallbackFunction","setLiveness","loadFaceApi","setLoading","createVideoElement","startVideo","createModalConfirmationWrapper","createModalConfirmation","destroyLiveness","removeCanvas","resetVideoWrapper","closePreviewModal","base64","removeLoading","createCanvasBackground","canvasBackground","getDevicePixelRatio","devicePixelRatio","style","display","sweepVideo","data","luminanceAvg","brightnessSum","luminanceArray","x","length","r","g","b","sweepBrightness","sweepLuminance","checkBrightness","test","navigator","userAgent","brightness","floor","canvasLuminance","calcLuminance","push","luminance","colorFactor","colorArray","i","pow","mediaQuery","isFirefox","toLowerCase","indexOf","matchMedia","matches","script","faceJS","append","onload","async","loadFaceApiModels","setTimeout","Promise","all","nets","faceLandmark68Net","loadFromUri","faceExpressionNet","faceRecognitionNet","then","tinyFaceDetector","console","log","catch","e","error","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","resolve","reject","call","Error","enumerateDevices","devices","frameRate","facingMode","backCamera","filter","device","kind","label","includes","deviceId","querySelector","streamLiveness","URL","createObjectURL","err","position","ariaLabel","transform","setAttribute","addEventListener","loop","innerHTML","getElementsByTagName","remove","responsiveFrameBoxEyesOutterWidth","windowWidth","blockMaskMessage","createCanvasFromMedia","left","top","faceapiConfig","matchDimensions","boxesWidth","innerWidth","center","ellipseMaskLineWidth","createMessageBox","ctx","translate","scale","drawEllipse","draw","isBackgroundOK","setInterval","checkBackground","state","counter","inProgress","done","canvasPosition","getBoundingClientRect","onLine","setHasNoNetwork","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","limitCounterFaceDiscovery","toggleModalFaceNotFound","blockMask","resizedDetections","resizeResults","expressions","expression","getExpression","detection","pose","getPose","jaw","landmarks","getJawOutline","isRotatedFace","beginPath","lineWidth","strokeStyle","moveTo","y","lineTo","stroke","leftEye","meanPosition","rightEye","centerEyes","positions","frameboxTop","frameboxLeft","frameboxWidth","frameboxHeight","frameboxCenter","eyesOutterTop","eyesOutterLeft","eyesOutterWidth","eyesOutterHeight","eyesInnerTop","eyesInnerLeft","eyesInnerWidth","eyesInnerHeight","hasBackgroundValidation","hasFaceLeftValidation","isFaceLeft","hasFaceRightValidation","isFaceRight","hasInsideFrameBoxValidation","isInsideFramebox","hasFaceAboveValidation","isFaceAbove","hasFaceBelowValidation","isFaceBelow","hasFaceAwayValidation","isFaceAway","hasFaceCloserValidation","isFaceCloser","hasFaceNotBetweenEyesBoxValidation","isNotBetweenEyesBoxes","hasNotInsideEllipeValidation","isNotInsideEllipse","activateEllipseMask","removeMessageBox","countdown","takePicture","counterInterval","printCountdown","hasCounter","getElementById","spinner","replace","insertAdjacentHTML","deactivateEllipseMask","expArr","key","Object","entries","confidence","exp","sort","a","pop","res","eye_right","getMeanPosition","getRightEye","eye_left","getLeftEye","nose","getNose","mouth","getMouth","rx","getTop","ry","score","p1","p2","abs","atan2","PI","l","map","reduce","min","isInside","isFaceUp","eyePosition","elementTop","isFaceDown","elementBottom","tolerance","framePositions","isLeftEyeInsideFramebox","isRightEyeInsideFramebox","outterBoxPositions","isLeftEyeAway","isRightEyeAway","isLeftEyeCloser","isRightEyeCloser","isLeftEyeBelow","isRightEyeBelow","isLeftEyeAbove","isRightEyeAbove","leftOk","rightOk","isLeftEyeInsideEllipse","isRightEyeInsideEllipse","isTopIn","isLeftOut","cachedBlockMaskMessage","msg","elMessage","role","textContent","rect","w","h","ellipse","createFlashMask","drawImage","fillStyle","fillRect","pictureData","getImageData","putImageData","toDataURL","dispatchEvent","removeFlashMask","openPreviewModal","confirmPicture","context","parseFloat","toFixed","flash","background","zIndex","id","modalWrapper","modalFaceNotFound","confirmButton","footer","modal","focus","modalConfirmation","cancelButton","cancelPicture","image","downloadImage","anchor","click","setLoadingAccessibilityProgress","removeLoadingAccessibilityProgress","hasSpinner","setLoadingProgress","getTips","xhr","tips","response","JSON","parse","status","message","join","endpoint","XMLHttpRequest","open","setRequestHeader","upload","loaded","total","onreadystatechange","readyState","OPENED","LOADING","UNSENT","DONE","isAlive","sendBase64","sendFormData","send","stringify","toB64","formData","toFormData","FormData","responseFetch","fetch","blob","split","sendPictureByXmlRequest","sendToApi","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"liveness.js","sourcesContent":["\"use strict\";\nclass Liveness {\n\n  constructor (videoWrapper, config) {\n    this.uploadInProgress = 0.00\n    this.requestType = 'b64'\n    this.counterNotFoundFace = 0\n    this.faceapi = null\n    this.token = config.token\n    this.videoWrapper = videoWrapper\n    this.configFrameBox = config.frameBox\n\n    if (config.scalingFactorForLiveness &&\n      config.scalingFactorForLiveness !== 0 &&\n        config.scalingFactorForLiveness <= 3) {\n      this.scalingFactorForLiveness = config.scalingFactorForLiveness\n    } else this.scalingFactorForLiveness = 1\n\n    this.config = {\n      ellipseMaskWidth: config.ellipseMaskWidth,\n      ellipseMaskHeight: config.ellipseMaskHeight,\n      ellipseMaskTop: config.ellipseMaskTop,\n      ellipseMaskLeft: config.ellipseMaskLeft,\n      mobileFacingMode: config.mobileFacingMode || 'user',\n      width: config.width || this.getFullWidth(),\n      height: config.height || this.getFullHeight()\n    }\n\n    this.config.heightAspectRatio = this.isMobile()\n     ? this.config.width * (4 / 3)\n     : this.config.width / (4 / 3)\n    this.config.isDebug = config.isDebug\n\n    const cssOrientationStyle = document.createElement('style')\n    cssOrientationStyle.innerText = this.cssOrientationLock()\n    document.head.appendChild(cssOrientationStyle)\n    \n    if (config.brightnessControl) this.brightnessControl = config.brightnessControl\n    else this.brightnessControl = 95\n\n    if (config.luminanceControl) this.luminanceControl = config.luminanceControl\n    else this.luminanceControl = 23\n\n    this.faceapiPath = config.faceapiPath\n    this.isShowPreview = config.isShowPreview\n    this.errorCallback = config.errorCallback\n    this.successCallback = config.successCallback\n    this.livenessUrlBase = config.livenessUrlBase\n    this.livenessConfirmEndpoint = config.livenessConfirmEndpoint || '/liveness/v2'\n    this.ellipseStrokeStyleDefault = config.ellipseStrokeStyle || '#D02780'\n    this.activatedEllipseStrokeStyle = config.activatedEllipseStrokeStyle || '#46E3C3'\n    this.boxMessageBackgroundColor = config.boxMessageBackgroundColor || '#D02780'\n    this.boxMessageTextColor = config.boxMessageTextColor || '#f3f3f5'\n    this.configEyesBoxHeight = config.configEyesBoxHeight || 20\n    this.requestAnimationFrame = window.requestAnimationFrame\n    this.shouldCheckNeutralFace = config.shouldCheckNeutralFace || false\n    this.facetimeInterval = config.facetimeInterval || 150\n    this.timeToDetectFace = config.timeToDetectFace || 6000\n    this.showNotFoundModal = config.showNotFoundModal || false\n    this.cameraPermissionErrorCallback = config.cameraPermissionErrorCallback || null\n    this.ignoreFaceRules = config.ignoreFaceRules || false\n    this.activateCountdown = config.activateCountdown || false\n    this.onRequestDone = config.onRequestDone\n    this.onRequestUploadEnd = config.onRequestUploadEnd\n    this.onRequestUploadStart = config.onRequestUploadStart\n    this.onRequestOpened = config.onRequestOpened\n    this.onRequestLoading = config.onRequestLoading\n    this.onRequestUnsent = config.onRequestUnsent\n    this.validations = !this.ignoreFaceRules\n    ? [\n      'background',\n      'faceLeft',\n      'faceRight',\n      'insideFrameBox',\n      'faceAbove',\n      'faceBelow',\n      'faceAway',\n      'faceCloser',\n      'faceNotBetweenEyesBox'\n    ]\n    : [\n      'faceLeft',\n      'faceRight',\n      'faceAbove',\n      'faceBelow',\n      'notInsideEllipse'\n    ]\n    this.validations = config.validations || this.validations\n    this.shouldAutoSendToApi = true\n    if (config.shouldAutoSendToApi !== undefined) {\n      this.shouldAutoSendToApi = config.shouldAutoSendToApi\n    }\n    this.createCustomEvents()\n    this.selectedLang = config.language || 'pt'\n    this.languages = {\n      pt: {\n        unmatchedFace: 'Face não encaixada',\n        keepNeutralFace: 'Mantenha expressão neutra',\n        centerYourFace: 'Alinhe seu rosto à tela',\n        darkEnvironment: 'O ambiente está escuro',\n        positionFaceWithinFrame: 'Posicione seu rosto dentro da moldura',\n        moveFaceAway: 'Afaste seu rosto',\n        moveFaceCloser: 'Aproxime seu rosto',\n        moveFaceDown: 'Desça a cabeça para encaixar na moldura',\n        moveFaceUp: 'Suba a cabeça para encaixar na moldura',\n        moveFaceRight: 'Mova a cabeça para a direita',\n        moveFaceLeft: 'Mova a cabeça para a esquerda',\n        mediaNotImplemented: 'getUserMedia não implementado nesse browser',\n        videoAriaLabel: 'Vídeo da face - Aproxime o rosto em posição de selfie e afaste-o lentamente para enquadrar',\n        countdownAriaText: 'contagem regressiva ##counter##',\n        countdownText: 'Evite se movimentar agora',\n        tiltedFace: 'Seu rosto está inclinado, deixe-o alinhado à tela',\n        faceNotFoundModalTitle: 'Atenção',\n        faceNotFoundModalDescription: 'Não foi possível realizar a captura, tente novamente',\n        faceNotFoundModalTopic1: 'Em um fundo neutro, de preferência com uma parede clara',\n        faceNotFoundModalTopic2: 'Em um ambiente com iluminação neutra (nem muito claro nem muito escuro)',\n        faceNotFoundModalTopic3: 'Removendo os adereços que prejudiquem a visualização da sua face, como cachecol, tocas, bonés e fones',\n        modalAriaPhotoTakenSuccessfully: 'Foto tirada com sucesso',\n        modalConfirmButtonText: 'Confirmar',\n        modalCancelButtonText: 'Cancelar',\n        progressWaitingAccessilityText: 'Aguarde enquanto estamos carregando e analisando a sua selfie',\n        finishedUploadHTMLText: '<strong>Aguarde enquanto estamos <br /> analisando a sua selfie</strong>',\n        uploadInProgressHTMLText: '<strong>Fazendo upload da selfie...<br /> (##progress##% enviados)</strong>',\n        noNetworkHTMLText: 'Estamos sem conexão<br />com a internet',\n      },\n      en: {\n        unmatchedFace: 'Face not matched',\n        keepNeutralFace: 'Keep neutral face',\n        centerYourFace: 'Align your face to the screen',\n        darkEnvironment: 'The environment is dark',\n        positionFaceWithinFrame: 'Position your face within the frame',\n        moveFaceAway: 'Move your face away',\n        moveFaceCloser: 'Move your face closer',\n        moveFaceDown: 'Move your face down to fit within the frame',\n        moveFaceUp: 'Move your face up to fit within the frame',\n        moveFaceRight: 'Move your face to the right',\n        moveFaceLeft: 'Move your face to the left',\n        mediaNotImplemented: 'getUserMedia is not implemented in this browser',\n        videoAriaLabel: 'face video - approach your face in selfie position and slowly move it away to frame',\n        countdownAriaText: 'countdown ##counter##',\n        countdownText: 'Avoid moving now',\n        tiltedFace: 'face is tilted, leave it aligned to the screen',\n        faceNotFoundModalTitle: 'Attention',\n        faceNotFoundModalDescription: 'Could not take a photo, try again',\n        faceNotFoundModalTopic1: 'In a neutral background, preferably with a light wall',\n        faceNotFoundModalTopic2: 'In a neutral lighting environment (neither too bright nor too dark)',\n        faceNotFoundModalTopic3: 'Remove any accessories that may impair the view of your face, such as scarves, hats, and headphones',\n        modalAriaPhotoTakenSuccessfully: 'Photo taken successfully',\n        modalConfirmButtonText: 'Confirm',\n        modalCancelButtonText: 'Cancel',\n        progressWaitingAccessilityText: 'Wait while we are loading and analyzing your selfie',\n        finishedUploadHTMLText: '<strong>Wait while we are <br /> analyzing your selfie</strong>',\n        uploadInProgressHTMLText: '<strong>Uploading selfie...<br /> (##progress##% sent)</strong>',\n        noNetworkHTMLText: 'We are offline',\n      },\n      es: {\n        unmatchedFace: 'Face no encajada',\n        keepNeutralFace: 'Mantenga la cara neutra',\n        centerYourFace: 'Centre su rostro en la pantalla',\n        darkEnvironment: 'El entorno es oscuro',\n        positionFaceWithinFrame: 'Posicione su rostro dentro del marco',\n        moveFaceAway: 'Mueva su rostro lejos',\n        moveFaceCloser: 'Mueva su rostro más cerca',\n        moveFaceDown: 'Mueva su rostro hacia abajo para encajar en el marco',\n        moveFaceUp: 'Mueva su rostro hacia arriba para encajar en el marco',\n        moveFaceRight: 'Mueva su rostro a la derecha',\n        moveFaceLeft: 'Mueva su rostro a la izquierda',\n        mediaNotImplemented: 'getUserMedia no está implementado en este navegador',\n        videoAriaLabel: 'vídeo de la cara - acerque su rostro en posición de selfie y aleje lentamente para enmarcar',\n        countdownAriaText: 'contagem regressiva ##counter##',\n        countdownText: 'Evite se movimentar agora',\n        tiltedFace: 'la cara está inclinada, deje-la alineada a la pantalla',\n        faceNotFoundModalTitle: 'Atención',\n        faceNotFoundModalDescription: 'No se pudo tomar una foto, intente de nuevo',\n        faceNotFoundModalTopic1: 'En un fondo neutro, de preferencia con una pared clara',\n        faceNotFoundModalTopic2: 'En un ambiente con iluminación neutra (ni muy claro ni muy oscuro)',\n        faceNotFoundModalTopic3: 'Retire cualquier accesorio que pueda perjudicar la vista de su cara, como bufandas, gorras y auriculares',\n        modalAriaPhotoTakenSuccessfully: 'Foto tomada con éxito',\n        modalConfirmButtonText: 'Confirmar',\n        modalCancelButtonText: 'Cancelar',\n        progressWaitingAccessilityText: 'Espere mientras estamos cargando y analizando su selfie',\n        finishedUploadHTMLText: '<strong>Espere mientras estamos <br /> analizando su selfie</strong>',\n        uploadInProgressHTMLText: '<strong>Cargando selfie...<br /> (##progress##% enviados)</strong>',\n        noNetworkHTMLText: 'Estamos sin conexión<br /> con la internet',\n      },\n      ...config.newLanguages\n    }\n    this.boxMessages = {\n      ...this.languages[this.selectedLang],\n    }\n  }\n  createCustomEvents () {\n    this.onPhotoTakenEvent = new CustomEvent('onphototaken')\n    this.onPreviewOpenEvent = new CustomEvent('onpreviewopen')\n    this.onPreviewCloseEvent = new CustomEvent('onpreviewclose')\n    this.onUploadStart = new CustomEvent('onuploadstart')\n    this.onUploadEnd = new CustomEvent('onuploadend')\n  }\n  getFullWidth () {\n    return Math.max(\n      document.body.scrollWidth,\n      document.documentElement.scrollWidth,\n      document.body.offsetWidth,\n      document.documentElement.offsetWidth,\n      document.documentElement.clientWidth\n    )\n  }\n  getFullHeight () {\n    return Math.max(\n      document.body.scrollHeight,\n      document.documentElement.scrollHeight,\n      document.body.offsetHeight,\n      document.documentElement.offsetHeight,\n      document.documentElement.clientHeight\n    );\n  }\n  setUseBase64 () {\n    this.requestType = \"b64\"\n  }\n\n  setUseFormData () {\n    this.requestType = \"formData\"\n  }\n\n  setMinBrightness (value) {\n    this.brightnessControl = value\n  }\n\n  setMinLuminance (value) {\n    this.luminanceControl = value\n  }\n\n  setMobileFaceCam () {\n    this.config.mobileFacingMode = 'user'\n    this.resetLiveness()\n  }\n\n  setMobileEnvironmentCam () {\n    this.config.mobileFacingMode = 'environment'\n    this.resetLiveness()\n  }\n\n  setFrameBoxesWidth (eyesInner, eyesOutter, box) {\n    this.configFrameBox = {\n      eyesInner,\n      eyesOutter,\n      box\n    }\n  }\n  setDimensionsRequestImage (width, height) {\n    this.config.dimensions = {\n      width,\n      height\n    }\n  }\n  toggleDebug () {\n    this.config.isDebug = !this.config.isDebug\n    if (!this.config.isDebug) {\n      const ctx = this.canvas.getContext('2d')\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    }\n  }\n\n  setEyesBoxHeight (pixels) {\n    this.configEyesBoxHeight = pixels\n  }\n\n  stop () {\n    this.video.pause()\n    const tracks = this.stream.getTracks()\n    tracks.forEach(track => track.stop())\n    if (this.video.src) this.video.src = null\n    if (this.video.srcObject) this.video.srcObject = null\n    clearInterval(this.timer)\n    clearInterval(this.timerBackground)\n  }\n\n  setCheckNeutralFace (value) {\n    this.shouldCheckNeutralFace = value\n  }\n\n  async start (callback) {\n    this.startCallbackFunction = callback\n    if (!window.faceapi) {\n      await this.loadFaceApi()\n    } else {\n      this.faceapi = window.faceapi\n      this.setLiveness()\n    }\n  }\n\n  setLiveness () {\n    this.setLoading()\n    this.createVideoElement()\n    .startVideo()\n    .createModalConfirmationWrapper()\n    .createModalConfirmation()\n  }\n\n  destroyLiveness () {\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n  }\n\n  resetLiveness () {\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n    this.closePreviewModal()\n    this.base64 = ''\n    this.removeLoading()\n    this.setLiveness()\n  }\n\n  cssOrientationLock () {\n    return '@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) { html { transform: rotate(-90deg);transform-origin: left top;width: 100vh;overflow-x: hidden;position: absolute;top: 100%;left: 0;}}'\n  }\n\n  createCanvasBackground () {\n    this.canvasBackground = document.createElement('canvas')\n    const width = this.videoWrapper.clientWidth * this.getDevicePixelRatio()\n    const height = this.videoWrapper.clientHeight * this.getDevicePixelRatio()\n\n    this.canvasBackground.width = this.isMobile()\n      ? this.video.clientWidth * (window.devicePixelRatio || 2)\n      : this.config.width\n    this.canvasBackground.height = this.isMobile()\n      ? this.config.heightAspectRatio * (window.devicePixelRatio || 2)\n      : this.config.height\n    \n    if (this.scalingFactorForLiveness) {\n      this.canvasBackground.width = this.canvasBackground.width * this.scalingFactorForLiveness\n      this.canvasBackground.height = this.canvasBackground.height * this.scalingFactorForLiveness\n    }\n    \n    if (this.config.dimensions) {\n      this.canvasBackground.width = this.config.dimensions.width\n      this.canvasBackground.height = this.config.dimensions.height\n    }\n    this.canvasBackground.style.display = 'none'\n  }\n\n  sweepVideo (data) {\n    this.luminanceAvg = 0\n    this.brightnessSum = 0 \n    this.luminanceArray = []\n\n    for (let x = 0; x < data.length; x += 4) {\n      const r = data[x]\n      const g = data[x + 1]\n      const b = data[x + 2]\n      this.sweepBrightness(r, g, b)\n      this.sweepLuminance(r, g, b)\n    }\n    this.checkBrightness()\n  }\n\n  isMobile () {\n    const acceptedBrowser = /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i\n    return acceptedBrowser.test(navigator.userAgent)\n  }\n\n  checkBrightness () {\n    this.brightness = Math.floor(this.brightnessSum / (this.canvasLuminance.width * this.canvasLuminance.height))\n  }\n\n  sweepBrightness (r, g, b) {\n    this.brightnessSum += Math.floor((r + g + b) / 3)\n  }\n\n  sweepLuminance (r, g, b) {\n    this.luminanceAvg += this.calcLuminance(r, g, b)\n    this.luminanceArray.push(this.calcLuminance(r, g, b))     \n\n    this.luminance = (this.luminanceAvg / this.luminanceArray?.length) * 100\n  }\n\n  calcLuminance (r, g, b) {\n    let colorArray = [r, g, b]\n    let colorFactor\n    for (let i = 0; i < colorArray.length; i++) {\n        colorFactor = colorArray[i] / 255\n        if (colorFactor <= 0.03928) {\n            colorFactor = colorFactor / 12.92\n        } else {\n            colorFactor = Math.pow(((colorFactor + 0.055) / 1.055), 2.4)\n        }\n        colorArray[i] = colorFactor\n    }\n    return (colorArray[0] * 0.2126 + colorArray[1] * 0.7152 + colorArray[2] * 0.0722) + 0.05\n  }\n  getDevicePixelRatio () {\n    let mediaQuery\n    const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1\n    if (window.devicePixelRatio !== undefined && !isFirefox) {\n      return window.devicePixelRatio\n    } else if (window.matchMedia) {\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 1.5),\\\n        (min--moz-device-pixel-ratio: 1.5),\\\n        (-o-min-device-pixel-ratio: 3/2),\\\n        (min-resolution: 1.5dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 1.5\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 2),\\\n        (min--moz-device-pixel-ratio: 2),\\\n        (-o-min-device-pixel-ratio: 2/1),\\\n        (min-resolution: 2dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 2\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 0.75),\\\n        (min--moz-device-pixel-ratio: 0.75),\\\n        (-o-min-device-pixel-ratio: 3/4),\\\n        (min-resolution: 0.75dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 1.5\n      }\n    } else {\n      return 1\n    }\n  }\n\n  async loadFaceApi () {\n    const script = document.createElement('script')\n    const faceJS = `${this.faceapiPath}/face-api.min.js`\n    script.src = faceJS\n    document.head.append(script)\n    script.onload = async () => {\n      await this.loadFaceApiModels()\n    }\n    return this\n  }\n  async loadFaceApiModels () {\n    setTimeout(async () => {\n      Promise.all([\n        window.faceapi.nets.faceLandmark68Net.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceExpressionNet.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceRecognitionNet.loadFromUri(this.faceapiPath)\n      ])\n      .then(async () => {\n        await window.faceapi.nets.tinyFaceDetector.loadFromUri(this.faceapiPath)\n        console.log('Models were loaded')\n        this.faceapi = faceapi\n        this.setLiveness()\n      })\n      .catch(e => console.error('error', e))\n    }, 100)\n    return this\n  }\n\n  startVideo () {\n    if (navigator.mediaDevices === undefined) {\n      navigator.mediaDevices = {}\n    }\n    if (navigator.mediaDevices.getUserMedia === undefined) {\n      navigator.mediaDevices.getUserMedia = function(constraints) {\n        const getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n        if (!getUserMedia) {\n          return Promise.reject(new Error(this.languages[this.selectedLang]?.mediaNotImplemented))\n        }\n        return new Promise(function(resolve, reject) {\n          getUserMedia.call(navigator, constraints, resolve, reject)\n        })\n      }\n    }\n\n    navigator.mediaDevices.enumerateDevices()\n      .then(devices => {\n      const constraints = {\n        video: {  \n          width: this.config.width,\n          height: this.config.height,\n          frameRate: 24\n        }\n      }\n      if (this.isMobile()) constraints.video = { facingMode: this.config.mobileFacingMode }\n      else {\n        const backCamera = devices.filter(device => device.kind === 'videoinput' && !device.label.includes('m-de:vice'))[0]\n        if (backCamera) constraints.video.deviceId = backCamera.deviceId\n      }\n\n      navigator.mediaDevices.getUserMedia(constraints)\n        .then((stream) => {\n          const video = document.querySelector('video')\n\n          if (!video) return\n\n          this.stream = stream\n          navigator.streamLiveness = stream\n          if (\"srcObject\" in video) {\n            video.srcObject = stream\n          } else {\n            video.src = window.URL.createObjectURL(stream)\n          }\n          !!this.startCallbackFunction && this.startCallbackFunction()\n        }).catch(err => {\n          if (this.cameraPermissionErrorCallback) this.cameraPermissionErrorCallback(err)\n          else throw new Error(err)\n        })\n    })\n    return this\n  }\n  createVideoElement () {\n    this.videoWrapper.style.position = 'relative'\n    this.videoWrapper.style.width =  this.config.width + 'px'\n    this.videoWrapper.style.height = this.config.height < this.config.heightAspectRatio\n    ? this.config.height + 'px'\n    : this.config.heightAspectRatio + 'px'\n\n    this.video = document.createElement('video')\n    this.video.ariaLabel = this.languages[this.selectedLang]?.videoAriaLabel\n    this.video.style.width = 'inherit'\n    this.video.style.height = 'inherit'\n    if ( this.config.mobileFacingMode === 'user') {\n      this.video.style.transform = 'scaleX(-1)'\n    }\n    this.video.setAttribute('muted', true)\n    this.video.setAttribute('autoplay', true)\n    this.video.setAttribute('playsinline', '')\n    this.videoWrapper.append(this.video)\n    this.video.addEventListener('play', () => {\n      this.loop()\n      this.createCanvasBackground()\n    })\n    return this\n  }\n  resetVideoWrapper () {\n    if(this.videoWrapper) this.videoWrapper.innerHTML = ''\n  }\n\n  removeCanvas () {\n    const canvas = document.getElementsByTagName('canvas')[0]\n    if(canvas) canvas.remove()\n  }\n\n  responsiveFrameBoxEyesOutterWidth (windowWidth) {\n    switch (windowWidth) {\n      case 315:\n        return {\n          eyesInner: 0.74,\n          eyesOutter: 0.78,\n          box: 0.55\n        }\n        break;\n    \n      default:\n        return {\n          eyesInner: 0.52,\n          eyesOutter: 0.82,\n          box: 0.60\n        }\n        break;\n    }\n  }\n  loop () {\n    this.blockMaskMessage = this.boxMessages.unmatchedFace \n    this.canvas = this.faceapi.createCanvasFromMedia(this.video)\n\n    this.canvas.style.position = 'absolute'\n    this.canvas.style.left = 0\n    this.canvas.style.top = 0\n\n    this.videoWrapper.append(this.canvas)\n    const faceapiConfig = {\n      width: this.config.width,\n      height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n    }\n    this.faceapi.matchDimensions(this.canvas, faceapiConfig)\n    this.boxesWidth = this.responsiveFrameBoxEyesOutterWidth(window.innerWidth)\n\n    if (this.configFrameBox) this.boxesWidth = this.configFrameBox\n\n    const frameBox = {\n      width: Math.floor(this.config.width * this.boxesWidth.box),\n      height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n    }\n    if (this.configFrameBox?.height) {\n      frameBox.height = this.configFrameBox.height\n    }\n    frameBox.left = Math.floor((this.canvas.width / 2) - (frameBox.width / 2))\n    frameBox.top = Math.floor( (this.videoWrapper.clientHeight / 2) - (frameBox.height / 2)  )\n    frameBox.center = (frameBox.left + frameBox.width) / 1.5\n\n    const height = frameBox.height + this.configEyesBoxHeight\n    const eyesOutter = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesOutter)),\n      height: Math.floor((height / 5)),\n      top: Math.floor(frameBox.top + (frameBox.height * 0.3))\n    }\n    eyesOutter.left = Math.floor((frameBox.left + (frameBox.width / 1.95) - (eyesOutter.width / 1.95)))\n\n    const eyesInner = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesInner)),\n      height: Math.floor((height / 5)),\n      top: Math.floor(frameBox.top + (frameBox.height * 0.3))\n    }\n    eyesInner.left = Math.floor((frameBox.left + (frameBox.width / 1.96) - (eyesInner.width / 1.96)))\n\n    this.ellipseMaskWidth = !!this.config.ellipseMaskWidth\n      ? (frameBox.width / this.config.ellipseMaskWidth)\n      :  frameBox.width / 2 \n    this.ellipseMaskHeight = !!this.config.ellipseMaskHeight\n      ? (frameBox.height / this.config.ellipseMaskHeight)\n      :  frameBox.height / 2.5\n    this.ellipseMaskTop = !!this.config.ellipseMaskTop\n      ? (frameBox.top + frameBox.height) / this.config.ellipseMaskTop\n      : (frameBox.top + frameBox.height) / 1.9\n    this.ellipseMaskLeft = !!this.config.ellipseMaskLeft\n      ? eyesOutter.left + (eyesOutter.width / this.config.ellipseMaskLeft)\n      : eyesOutter.left + (eyesOutter.width / 2)\n  \n    this.ellipseMaskLineWidth = 2\n    this.createMessageBox()\n\n    const ctx = this.canvas.getContext('2d')\n    ctx.translate(this.canvas.width, 0)\n    ctx.scale(-1, 1)\n    this.drawEllipse(ctx)\n    // DEBUG\n    if (this.config.isDebug) {\n      this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n    }\n\n    if (!this.isMobile()) {\n      this.timerBackground = setInterval(() => {\n        this.checkBackground()\n      }, 1000);\n    } else this.isBackgroundOK = true\n\n    \n    const state = {\n      counter: 0,\n      inProgress: false,\n      done: false\n    }\n    \n    const canvasPosition = this.canvas.getBoundingClientRect()\n    this.timer = setInterval(async () => {\n      if (!navigator.onLine) {\n        this.setHasNoNetwork()\n        return\n      }\n      if (state.inProgress || state.done) {\n        return\n      }\n      state.inProgress = true\n\n      const detections = await this.faceapi.detectSingleFace(this.video, new this.faceapi.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceExpressions()\n\n      this.removeLoading()\n\n      const limitCounterFaceDiscovery = this.timeToDetectFace / this.facetimeInterval\n      if (this.showNotFoundModal && this.counterNotFoundFace > limitCounterFaceDiscovery) {\n        this.toggleModalFaceNotFound()\n      }\n\n      if (!detections) {\n        this.blockMaskMessage = this.boxMessages.unmatchedFace\n        this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n        state.counter = 0\n        state.inProgress = false\n        this.counterNotFoundFace++\n        return\n      } else this.counterNotFoundFace = 0\n\n      const resizedDetections = this.faceapi.resizeResults(detections, {\n        width: this.config.width,\n        height: this.config.height < this.config.heightAspectRatio\n        ? this.config.height\n        : this.config.heightAspectRatio\n      })\n\n      if (resizedDetections && resizedDetections.expressions && this.shouldCheckNeutralFace) {  \n        const expression = this.getExpression(resizedDetections.expressions)\n        if (expression !== 'neutral') {\n          if (this.config.isDebug) {\n            this.blockMaskMessage = `${this.boxMessages.keepNeutralFace} >> ${expression}`\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMaskMessage = this.boxMessages.keepNeutralFace\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n      }\n      \n      if (resizedDetections.detection) {\n\n        // POSE\n        const pose = this.getPose(resizedDetections)\n        if (pose !== 'front') {\n          if (this.config.isDebug) {\n            this.blockMaskMessage = `${this.boxMessages.centerYourFace} >> ${pose}`\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMaskMessage = this.boxMessages.centerYourFace\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // ANGLE\n        const jaw = resizedDetections.landmarks.getJawOutline()\n        const rotated = this.isRotatedFace(jaw[0], jaw[16])\n        if (rotated) {\n          if (this.config.isDebug) {\n            this.blockMaskMessage = `${this.boxMessages.centerYourFace} >> rotacionado`\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMaskMessage = this.boxMessages.centerYourFace\n            this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // DEBUG\n        if (this.config.isDebug) {\n          this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n          ctx.beginPath()\n          ctx.lineWidth = '5'\n          ctx.strokeStyle = '#FFFF00'\n          ctx.moveTo(jaw[0].x, jaw[0].y)\n          ctx.lineTo(jaw[16].x, jaw[16].y)\n          ctx.stroke()\n        }\n\n        const leftEye = {\n          meanPosition: [jaw[0].x, jaw[0].y],\n        }\n        const rightEye = { \n          meanPosition: [jaw[16].x, jaw[16].y],\n        }\n        const centerEyes = [jaw[8].x, jaw[8].y]\n\n        const positions = {\n          frameboxTop: frameBox.top,\n          frameboxLeft: frameBox.left,\n          frameboxWidth: frameBox.width,\n          frameboxHeight: frameBox.height,\n          frameboxCenter: frameBox.center,\n          eyesOutterTop: eyesOutter.top,\n          eyesOutterLeft: eyesOutter.left,\n          eyesOutterWidth: eyesOutter.width,\n          eyesOutterHeight: eyesOutter.height,\n          eyesInnerTop: eyesInner.top,\n          eyesInnerLeft: eyesInner.left,\n          eyesInnerWidth: eyesInner.width,\n          eyesInnerHeight: eyesInner.height\n        }\n\n        if (this.hasBackgroundValidation() && !this.isBackgroundOK) {\n          this.blockMaskMessage = this.boxMessages.darkEnvironment\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceLeftValidation() && this.isFaceLeft(centerEyes, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceRight\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceRightValidation() && this.isFaceRight(centerEyes, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceLeft\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasInsideFrameBoxValidation() && !this.isInsideFramebox(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.positionFaceWithinFrame\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceAboveValidation() && this.isFaceAbove(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceDown\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceBelowValidation() && this.isFaceBelow(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceUp\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceAwayValidation() && this.isFaceAway(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceCloser\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceCloserValidation() && this.isFaceCloser(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceAway\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasFaceNotBetweenEyesBoxValidation() && this.isNotBetweenEyesBoxes(leftEye.meanPosition, rightEye.meanPosition, positions)) {\n          this.blockMaskMessage = this.boxMessages.moveFaceCloser\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n        if (this.hasNotInsideEllipeValidation() && this.isNotInsideEllipse(leftEye.meanPosition, rightEye.meanPosition)) {\n          this.blockMaskMessage = this.boxMessages.positionFaceWithinFrame\n          this.blockMask(canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (this.ellipseMaskLineWidth < 6) this.ellipseMaskLineWidth *= 2\n        \n        this.activateEllipseMask()\n    \n        state.counter += 1\n        state.inProgress = false\n        if (state.counter >= 2) {\n          state.done = true\n          clearInterval(this.timer)\n          !!this.timerBackground && clearInterval(this.timerBackground)\n          this.removeMessageBox()\n\n          if (this.activateCountdown) this.countdown()\n          else this.takePicture()\n\n        } else {\n          clearInterval(this.counterInterval)\n        }\n      }\n      \n    }, this.facetimeInterval)\n  }\n\n  hasBackgroundValidation () {\n    return this.validations.includes('background')\n  }\n  hasFaceLeftValidation () {\n    return this.validations.includes('faceLeft')\n  }\n  hasFaceRightValidation () {\n    return this.validations.includes('faceRight')\n  }\n  hasInsideFrameBoxValidation() {\n    return this.validations.includes('insideFrameBox')\n  }\n  hasFaceAboveValidation () {\n    return this.validations.includes('faceAbove')\n  }\n  hasFaceBelowValidation () {\n    return this.validations.includes('faceBelow')\n  }\n  hasFaceAwayValidation () {\n    return this.validations.includes('faceAway')\n  }\n  hasFaceCloserValidation () {\n    return this.validations.includes('faceCloser')\n  }\n  hasFaceNotBetweenEyesBoxValidation () {\n    return this.validations.includes('faceNotBetweenEyesBox')\n  }\n  hasNotInsideEllipeValidation () {\n    return this.validations.includes('notInsideEllipse')\n  }\n\n  countdown () {\n    this.counter = 3\n    this.counterInterval = setInterval(() => {\n      this.printCountdown()\n      this.counter--\n      if (this.counter < 0) {\n        clearInterval(this.counterInterval)\n        this.takePicture()\n      }\n    }, 1000)\n  }\n\n  printCountdown() {\n    const hasCounter = document.getElementById('countdown')\n    if (!!hasCounter) hasCounter.remove()\n\n    const spinner = `\n        <div\n          role=\"alert\"\n          id=\"countdown\"\n          aria-label=\"${this.languages[this.selectedLang]?.countdownAriaText?.replace('##counter##', this.counter)}\"\n        >\n          <div class=\"lds-countdown\">\n            <strong>${this.counter}</strong>\n          </div>\n          <strong>${this.languages[this.selectedLang]?.countdownText}</strong>\n        <style>\n        #countdown {\n          top: 0;\n          gap:3rem;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          color: white;\n          display: flex;\n          position: absolute;\n          text-align: center;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background-color: rgba(50, 50, 50, 0.4);\n        }\n        .lds-countdown {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        #countdown > strong {\n          font-size: 1.8rem;\n          padding: 0.5rem;\n          background: black;\n          border-radius: 1rem;\n        }\n        .lds-countdown strong {\n          font-size: 5rem;\n          padding: 0.5rem;\n          background: black;\n          border-radius: 1rem;\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner) \n  }\n\n  activateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.drawEllipse(ctx, this.activatedEllipseStrokeStyle)\n  }\n\n  deactivateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.ellipseMaskLineWidth = 3\n    this.drawEllipse(ctx)\n  }\n  \n  getExpression (expressions) {\n    const expArr = []\n    for (const [key, value] of Object.entries(expressions)) {\n      expArr.push({ expression: key, confidence: value })\n    }\n    const exp = expArr.sort((a, b) => a.confidence - b.confidence).pop()\n    return (exp && exp.expression) ? exp.expression : null\n  }\n  getPose(res) {\n    const eye_right = this.getMeanPosition(res.landmarks.getRightEye())\n    const eye_left = this.getMeanPosition(res.landmarks.getLeftEye())\n    const nose = this.getMeanPosition(res.landmarks.getNose())\n    const mouth = this.getMeanPosition(res.landmarks.getMouth())\n    const jaw = this.getTop(res.landmarks.getJawOutline())\n    const rx = (jaw - mouth[1]) / res.detection.box.height + 0.45\n    const ry = (eye_left[0] + (eye_right[0] - eye_left[0]) / 2 - nose[0]) / res.detection.box.width\n    let state = 'undetected'\n\n    if (res.detection.score > 0.3) {\n      state = 'front'\n      if (rx > 0.2) {\n        state = 'top'\n      } else if (rx < -0.1) {\n        state = 'bottom'\n      } else {\n        if (ry < -0.04) {\n          state = 'left'\n        }\n        if (ry > 0.04) {\n          state = 'right'\n        }\n      }\n    }\n    return state\n  }\n  isRotatedFace (p1, p2) {\n    const angleDeg = Math.abs(Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI)\n    return angleDeg > 7\n  }\n  getMeanPosition (l) {\n    return l\n      .map((a) => [a.x, a.y])\n      .reduce((a, b) => [a[0] + b[0], a[1] + b[1]])\n      .map((a) => a / l.length)\n  }\n  getTop (l) {\n    return l\n      .map((a) => a.y)\n      .reduce((a, b) => Math.min(a, b))\n  }\n  isInside (a = [], b = {}) {\n    if (a[1] < b.top) {\n      return false\n    }\n    if (a[0] < b.left) {\n      return false\n    }\n    if (a[1] > b.top + b.height) {\n      return false\n    }\n    if (a[0] > b.left + b.width) {\n      return false\n    }\n    return true\n  }\n\n  isFaceUp (eyePosition = [], elementTop) {\n    return eyePosition[1] < elementTop\n      ? true\n      : false\n  }\n\n  isFaceDown (eyePosition = [], elementBottom) {\n    return eyePosition[1] > elementBottom\n      ? true\n      : false\n  }\n\n  isFaceLeft (centerEyes, positions) {\n    const tolerance = positions.frameboxCenter - (positions.frameboxCenter * -0.05)\n    return centerEyes[0] > tolerance\n  }\n\n  isFaceRight (centerEyes, positions) {\n    const tolerance = positions.frameboxCenter + (positions.frameboxCenter * -0.05)\n    return centerEyes[0] < tolerance\n  }\n\n  isInsideFramebox (leftEye, rightEye, positions) {\n    const framePositions = {\n      top: positions.frameboxTop,\n      left: positions.frameboxLeft,\n      width: positions.frameboxWidth,\n      height: positions.frameboxHeight,\n    }\n    return this.isLeftEyeInsideFramebox(leftEye, framePositions) &&\n    this.isRightEyeInsideFramebox(rightEye, framePositions)\n  }\n  isLeftEyeInsideFramebox (leftEye, positions) {\n    return this.isInside(leftEye, positions)\n  }\n  isRightEyeInsideFramebox (rightEye, positions) {\n    return this.isInside(rightEye, positions)\n  }\n\n  isFaceAway (leftEye, rightEye, positions) {\n    const outterBoxPositions = {\n      top: positions.eyesInnerTop,\n      left: positions.eyesInnerLeft,\n      width: positions.eyesInnerWidth,\n      height: positions.eyesInnerHeight,\n    }\n    return this.isLeftEyeAway(leftEye, outterBoxPositions) &&\n    this.isRightEyeAway(rightEye, outterBoxPositions)\n  }\n  isLeftEyeAway (leftEye, positions) {\n    return this.isInside(leftEye, positions)\n  }\n  isRightEyeAway (rightEye, positions) {\n    return this.isInside(rightEye, positions)\n  }\n\n  isFaceCloser (leftEye, rightEye, positions) {\n    const outterBoxPositions = {\n      top: positions.eyesOutterTop,\n      left: positions.eyesOutterLeft,\n      width: positions.eyesOutterWidth,\n      height: positions.eyesOutterHeight,\n    }\n    return this.isLeftEyeCloser(leftEye, outterBoxPositions) &&\n    this.isRightEyeCloser(rightEye, outterBoxPositions)\n  }\n  isLeftEyeCloser (leftEye, positions) {\n    return !this.isInside(leftEye, positions)\n  }\n  isRightEyeCloser (rightEye, positions) {\n    return !this.isInside(rightEye, positions)\n  }\n\n  isFaceBelow (leftEye, rightEye, positions) {\n    return this.isLeftEyeBelow(leftEye, positions) ||\n    this.isRightEyeBelow(rightEye, positions)\n  }\n  isLeftEyeBelow (leftEye, positions) {\n    return leftEye[1] > (positions.eyesOutterTop + positions.eyesOutterHeight)\n  }\n  isRightEyeBelow (rightEye, positions) {\n    return rightEye[1] > (positions.eyesOutterTop + positions.eyesOutterHeight)\n  }\n\n  isFaceAbove (leftEye, rightEye, positions) {\n    return this.isLeftEyeAbove(leftEye, positions) ||\n    this.isRightEyeAbove(rightEye, positions)\n  }\n  isLeftEyeAbove (leftEye, positions) {\n    return leftEye[1] < positions.eyesOutterTop\n  }\n  isRightEyeAbove (rightEye, positions) {\n    return rightEye[1] < positions.eyesOutterTop\n  }\n\n  isNotBetweenEyesBoxes (leftEye, rightEye, positions) {\n    const leftOk = (rightEye[0] < (positions.eyesOutterLeft + positions.eyesOutterWidth) \n      && rightEye[0] > (positions.eyesInnerLeft + positions.eyesInnerWidth))\n    const rightOk = (leftEye[0] > positions.eyesOutterLeft && leftEye[0] < positions.eyesInnerLeft)\n    return !(leftOk && rightOk)\n  }\n\n  isNotInsideEllipse(leftEye, rightEye) {\n    return !(this.isLeftEyeInsideEllipse(leftEye) &&\n      this.isRightEyeInsideEllipse(rightEye))\n  }\n\n  isLeftEyeInsideEllipse(leftEye) {\n    const isTopIn = leftEye[1] > (this.ellipseMaskTop - this.ellipseMaskHeight) && leftEye[1] < (this.ellipseMaskTop + (this.ellipseMaskTop - this.ellipseMaskHeight))\n    const isLeftOut = leftEye[0] < this.ellipseMaskLeft && leftEye[0] > (this.ellipseMaskLeft- (this.ellipseMaskWidth / 2))\n    return isTopIn && !isLeftOut\n  }\n\n  isRightEyeInsideEllipse(rightEye, positions) {\n    const isTopIn = rightEye[1] > (this.ellipseMaskTop - this.ellipseMaskHeight) && rightEye[1] < (this.ellipseMaskTop + (this.ellipseMaskTop - this.ellipseMaskHeight))\n    const isLeftOut = rightEye[0] < this.ellipseMaskLeft && rightEye[0] > (this.ellipseMaskLeft - (this.ellipseMaskWidth * 4))\n    return isTopIn && !isLeftOut\n  }\n\n  blockMask (canvasPosition, left, top, height, width) {\n    const MASK_WHITE_BORDER = 50\n    const dimensions = {\n      width: 230,\n      height: 35\n    }\n    dimensions.top = top + height + 20\n    dimensions.left = (left + (width / 2)) - (dimensions.width / 2)\n\n    if (this.blockMaskMessage === this.cachedBlockMaskMessage) return\n    this.cachedBlockMaskMessage = this.blockMaskMessage\n    this.deactivateEllipseMask()\n\n    this.msg.innerHTML = ''\n    const elMessage = document.createElement('span')\n    elMessage.role = 'alert'\n    \n    elMessage.ariaLabel = this.blockMaskMessage === this.languages[this.selectedLang]?.centerYourFace\n      ? this.languages[this.selectedLang]?.tiltedFace\n      : this.blockMaskMessage\n\n    elMessage.textContent = this.blockMaskMessage\n    elMessage.style = \n    `\n      display: flex;\n      color: ${this.boxMessageTextColor};\n      font-size: 1.2rem;\n      font-weight: 600;\n      padding: 10px 20px;\n      text-align: center;\n      align-items: center;\n      background: ${this.boxMessageBackgroundColor};\n      border-radius: 7px;\n      justify-content: center;\n      width: ${dimensions.width}px;\n      font-family: Prompt, sans-serif;\n    `\n    this.msg.style.display = 'flex'\n    this.msg.appendChild(elMessage)\n  }\n  draw (ctx, canvas, frameBox, eyesInner, eyesOutter) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.beginPath()\n    ctx.lineWidth = 1\n    ctx.strokeStyle = 'green'\n    ctx.rect(frameBox.center, frameBox.top, 2, frameBox.height)\n    ctx.stroke()\n\n    ctx.beginPath()\n    ctx.lineWidth = 3\n    ctx.strokeStyle = 'blue'\n    ctx.rect(frameBox.left, frameBox.top, frameBox.width, frameBox.height)\n    ctx.stroke()\n\n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'yellow'\n    ctx.rect(eyesInner.left, eyesInner.top, eyesInner.width, eyesInner.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'red'\n    ctx.rect(eyesOutter.left, eyesOutter.top, eyesOutter.width, eyesOutter.height)\n    ctx.stroke()\n    this.drawEllipse(ctx)\n  }\n\n  drawEllipse(ctx, style) {\n    const x = this.ellipseMaskLeft\n    const y = this.ellipseMaskTop\n    const w = this.ellipseMaskWidth\n    const h = this.ellipseMaskHeight\n\n    ctx.beginPath()\n    ctx.lineWidth = this.ellipseMaskLineWidth\n\n    ctx.ellipse(x, y, w, h, 0, 0, Math.PI * 2)\n    ctx.strokeStyle = style || this.ellipseStrokeStyleDefault\n\n    ctx.stroke();\n  }\n  takePicture () {\n    const ctx = this.canvasBackground.getContext('2d')\n    this.canvasBackground.style.display = 'none;'\n    this.createFlashMask()\n    ctx.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    ctx.fillStyle = \"#475444\"\n    ctx.fillRect(20, 50, 1, 1)\n    ctx.fillStyle = \"#D3BE7C\"\n    ctx.fillRect(422, 522, 1, 1)\n    const pictureData = ctx.getImageData(0,0,this.canvasBackground.width,this.canvasBackground.height)\n    ctx.putImageData(pictureData, 0, 0)\n    this.base64 = this.canvasBackground.toDataURL('image/png')\n    window.dispatchEvent(this.onPhotoTakenEvent)\n\n    setTimeout(() => {\n      this.removeFlashMask()\n\n      if(this.isShowPreview) {\n        this.openPreviewModal()\n      }\n      else {\n        this.confirmPicture()\n      }\n      \n    }, 300)\n  }\n  checkBackground () {\n    this.canvasLuminance = document.createElement('canvas')\n    const width = this.videoWrapper.clientWidth / 2\n    const height = this.videoWrapper.clientHeight / 2\n\n    const context = this.canvasLuminance.getContext('2d')\n\n    context.drawImage(this.video, 0, 0, this.canvasLuminance.width, this.canvasLuminance.height)\n    const pictureData = context.getImageData(0,0,this.canvasLuminance.width,this.canvasLuminance.height)\n    this.sweepVideo(pictureData.data)\n\n    this.isBackgroundOK = (this.brightness >= this.brightnessControl && this.luminance >= this.luminanceControl)\n\n    if (this.config.isDebug) {\n      const table = {\n        brilho: {\n          atual: this.brightness,\n          'mín aceitável': this.brightnessControl,\n        },\n        'luminância': {\n          atual: parseFloat(this.luminance.toFixed(2)),\n          'mín aceitável': this.luminanceControl\n        }\n      }\n      // console.table(table)\n    }\n  }\n  createFlashMask () {\n    const flash = document.createElement('div')\n    flash.style.width = '100%'\n    flash.style.height = '100vh'\n    flash.style.position = 'fixed'\n    flash.style.background = 'white'\n    flash.style.zIndex = 999\n    flash.style.top = 0\n    flash.style.left = 0\n    flash.id = 'flash'\n    document.body.append(flash)\n  }\n  removeFlashMask () {\n    const flash = document.getElementById('flash')\n    flash.remove()\n  }\n  createMessageBox () {\n    const box = document.getElementById('liveness-box-message')\n    if (!!box) box.remove()\n    this.msg = document.createElement('div')\n    this.msg.id = 'liveness-box-message'\n    this.msg.style = `\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      z-index: 999;\n      background: transparent;\n      position: absolute;\n      top: ${this.ellipseMaskTop + this.ellipseMaskHeight}px;\n    `\n    this.videoWrapper.append(this.msg)\n    return this\n  }\n  removeMessageBox () {\n    const box = document.getElementById('liveness-box-message')\n    if (!!box) box.remove()\n  }\n  toggleModalFaceNotFound () {\n    const hasModal = document.getElementById('modal-liveness-face-not-found')\n    if (!!hasModal) return\n\n    const modalWrapper = document.createElement('div')\n    modalWrapper.id = 'modal-liveness-face-not-found'\n    modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 21;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    display: grid;\n    align-items: flex-start;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n\n    const modalFaceNotFound = document.createElement('div')\n    modalFaceNotFound.style = `\n    gap: 10px;\n    margin-top: 50px;\n    padding: 15px 10px;\n    display: grid;\n    background: white;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    font-family: Prompt, sans-serif;\n    `\n    modalFaceNotFound.innerHTML = \n    `\n      <h3>${this.languages[this.selectedLang]?.faceNotFoundModalTitle}</h3>\n      <p role=\"alert\" style=\"width: 100%\">${this.languages[this.selectedLang]?.faceNotFoundModalDescription}:</p>\n      <ul style=\"width: 100%; display: grid; gap: 5px;\">\n        <li>${this.languages[this.selectedLang]?.faceNotFoundModalTopic1}</li>\n        <li>${this.languages[this.selectedLang]?.faceNotFoundModalTopic2}</li>\n        <li>${this.languages[this.selectedLang]?.faceNotFoundModalTopic3}</li>\n      </ul>\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = 'OK'\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 130px;\n    height: 30px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    z-index: 1;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    justify-content: center;\n    `\n    footer.append(confirmButton)\n    modalFaceNotFound.append(footer)\n    modalWrapper.append(modalFaceNotFound)\n    confirmButton.addEventListener('click', () => {\n      this.counterNotFoundFace = 0\n      const modal = document.getElementById('modal-liveness-face-not-found')\n      if (!!modal) {\n        modal.remove()\n      }\n    })\n    document.body.append(modalWrapper)\n    confirmButton.focus()\n\n    return this\n  }\n  createModalConfirmationWrapper () {\n    this.modalWrapper = document.createElement('div')\n    this.modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 999;\n    width: ${this.videoWrapper.style.width};\n    height: ${this.videoWrapper.style.height};\n    display: none;\n    position: fixed;\n    align-items: flex-start;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n    this.modalWrapper.id = 'modalWrapper'\n    document.body.append(this.modalWrapper)\n    return this\n  }\n  createModalConfirmation () {\n    this.modalConfirmation = document.createElement('div')\n    this.modalConfirmation.ariaLabel = this.languages[this.selectedLang]?.modalAriaPhotoTakenSuccessfully\n    this.modalConfirmation.role = 'alert'\n    this.modalConfirmation.style = `\n    padding: 7px;\n    display: flex;\n    width: ${this.videoWrapper.style.width};\n    height: ${this.videoWrapper.style.height};\n    background: white;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = this.languages[this.selectedLang]?.modalConfirmButtonText\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const cancelButton = document.createElement('button')\n    cancelButton.textContent = this.languages[this.selectedLang]?.modalCancelButtonText\n    cancelButton.style = `\n    color: #444;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    position: absolute;\n    justify-content: center;\n    `\n    footer.append(cancelButton)\n    footer.append(confirmButton)\n    this.modalConfirmation.append(footer)\n    this.modalWrapper.append(this.modalConfirmation)\n    confirmButton.addEventListener('click', () => {\n      this.closePreviewModal()\n      this.confirmPicture()\n    })\n    cancelButton.addEventListener('click', () => {\n      this.closePreviewModal()\n      this.cancelPicture()\n    })\n    confirmButton.focus()\n    return this\n  }\n\n  openPreviewModal () {\n    window.dispatchEvent(this.onPreviewOpenEvent)\n    const image = document.createElement('img')\n    image.src = this.base64\n    image.style = `\n    width: 100%;\n    height: 100%;\n    max-width: ${this.videoWrapper.clientWidth};\n    object-fit: cover;\n    border-radius: 7px;\n    transform: scaleX(-1);\n    `\n    this.modalConfirmation.append(image)\n    this.modalWrapper.style.display = 'flex'\n  }\n\n  closePreviewModal () {\n    const modal = document.getElementById('modalWrapper')\n    if (modal) {\n      modal.remove()\n      window.dispatchEvent(this.onPreviewCloseEvent)\n    }\n  }\n\n  cancelPicture () {\n    this.resetLiveness()\n  }\n\n  downloadImage () {\n    const anchor = createElement('a')\n    anchor.setAttribute('download', 'image.png')\n    anchor.setAttribute('href', this.base64)\n    anchor.click()\n    setTimeout(() => {\n      anchor.remove()\n    }, 1000);\n  }\n\n  setLoading () {\n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n        <div id=\"spinner-message\" />\n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        #spinner-message {\n          width: 100%;\n          display: flex;\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  setLoadingAccessibilityProgress () {\n    this.removeLoadingAccessibilityProgress()\n    \n    const spinner = `<div id=\"spinneracc\" role=\"alert\" style=\"opacity: 0\">\n        <p class=\"liveness-progress-text-accessibility\">\n          ${this.languages[this.selectedLang]?.progressWaitingAccessilityText}\n        </p>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n  removeLoadingAccessibilityProgress () {\n    const hasSpinner = document.getElementById('spinneracc')\n    if (hasSpinner) hasSpinner.remove() \n  }\n  setLoadingProgress () { \n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n    const spinner = `<div id=\"spinner\">\n        <p class=\"liveness-progress-text\">\n          ${\n            this.uploadInProgress === 100\n            ? this.languages[this.selectedLang]?.finishedUploadHTMLText\n            : this.languages[this.selectedLang]?.uploadInProgressHTMLText?.replace('##progress##', this.uploadInProgress?.toFixed(0))\n          }\n        </p>\n    \n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        .liveness-progress-text {\n          color: white;\n          text-align: center;\n          font-size: 1.2rem;\n          font-weight: 500;\n        }\n        .liveness-progress-text strong {\n          opacity: 1;\n          animation: blink-text 1s ease infinite alternate;\n        }\n        @keyframes blink-text {\n          from {\n            opacity: 1;\n          }\n          to {\n            opacity: 0.4;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  getTips (xhr) {\n    const tips = []\n    const response = JSON.parse(xhr?.response)\n\n    if (xhr.status === 401) {\n      tips.push(`Verifique seu token. Token inválido ou não possui permissão para esse produto::${response?.error?.message}`)\n      return tips.join(', ')\n    }\n    if (xhr.status >= 500) {\n      tips.push(`Ocorreu um erro no servidor::${response?.error?.message}`)\n      return tips.join(', ')\n    }\n\n    tips.push(`Tamanho do video: ${this.videoWrapper.style.width} x ${this.videoWrapper.style.height}. Tamanho enviado para a API: ${this.canvasBackground.width}px x ${this.canvasBackground.height}px`)\n\n    const calcAspectRatio = this.canvasBackground.width / this.canvasBackground.height\n    if (calcAspectRatio.toFixed(2) !== '1.33') {\n      tips.push('A imagem não está com a proporção adequada. Tente a proporção 4/3 | Por ex.: 640x480, 800x600, 960x720 ou 1024x768')\n    }\n    if (!this.isMobile() && this.canvasBackground.width <= 320) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 3`)\n    }\n\n    if (!this.isMobile() && this.canvasBackground.width > 320 && this.canvasBackground.width <= 515) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 2`)\n    }\n\n    if (!this.isMobile() && this.canvasBackground.width > 515 && this.canvasBackground.width < 700) {\n      tips.push(`O tamanho da imagem está com tamanho e proporção adequados para desktop, porém não para o liveness. Tente usar na configuração inicial o config.scalingFactorForLiveness = 1.5`)\n    }\n    return tips.join(', ')\n  }\n\n  removeLoading () {\n    const spinner = document.getElementById('spinner')\n    if(spinner) spinner.remove()\n  }\n\n  setHasNoNetwork () {\n    const hasSpinner = document.getElementById('spinner')\n    if (!!hasSpinner) return \n\n\n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n        <p>${this.languages[this.selectedLang]?.noNetworkHTMLText}</p>\n        <style>\n        #spinner {\n          top: 0;\n          z-index: 999;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          flex-direction: column;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        #spinner p {\n          color: white;\n          font-size: 1.2rem;\n          font-weight: 500;\n          text-align: center;\n          animation: blink 1s linear infinite;\n        }\n\n        @keyframes blink {\n          0% {\n            opacity: 1;\n          }\n          100% {\n            opacity: 0.2;\n          }\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n\n  async sendPictureByXmlRequest () {\n    const endpoint = `${this.livenessUrlBase}${this.livenessConfirmEndpoint}`\n    const xhr = new XMLHttpRequest()\n    xhr.open('POST', endpoint, true)\n\n    xhr.setRequestHeader('Authorization', `Bearer ${this.token}`)\n\n    xhr.upload.addEventListener('loadstart', (e) => {\n      if (this.onRequestUploadStart) {\n        this.onRequestUploadStart(e)\n        return\n      }\n      this.stop()\n      this.setLoadingAccessibilityProgress()\n      window.dispatchEvent(this.onUploadStart)\n    })\n\n    xhr.upload.addEventListener('loadend', (e) => {\n      if (this.onRequestUploadEnd) {\n        this.onRequestUploadEnd(e)\n        return\n      }\n      window.dispatchEvent(this.onUploadEnd)\n      this.removeLoadingAccessibilityProgress()\n    })\n\n    xhr.upload.addEventListener('progress', (e) => {\n      this.uploadInProgress  = (e.loaded / e.total) * 100\n      this.removeLoading()\n      this.setLoadingProgress()\n    })\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === XMLHttpRequest.OPENED) {\n        this.onRequestOpened && this.onRequestOpened(xhr)\n      }\n      if (xhr.readyState === XMLHttpRequest.LOADING) {\n        this.onRequestLoading && this.onRequestLoading(xhr)\n      }\n      if (xhr.readyState === XMLHttpRequest.UNSENT) {\n        this.onRequestUnsent && this.onRequestUnsent(xhr)\n      }\n      if (xhr.readyState === XMLHttpRequest.DONE) {\n        const response = JSON.parse(xhr?.response)\n\n        if (!response?.data?.isAlive) response.tips = this.getTips(xhr)\n\n        switch (xhr.status) {\n          case 200:\n            this.successCallback({...response, base64: this.base64})\n            break;\n          case 401:\n            this.errorCallback({ error: response, base64: this.base64})\n            break;\n          default:\n            this.errorCallback({ error: response, base64: this.base64})\n            break;\n        }\n        if (this.onRequestDone) {\n          this.onRequestDone(xhr)\n          return\n        }\n        this.resetLiveness()\n      }\n    }\n    if (this.requestType === 'b64') {\n      await this.sendBase64(xhr)\n    } else {\n      await this.sendFormData(xhr)\n    }\n  }\n\n  async sendBase64 (xhr) {\n    xhr.setRequestHeader('Content-Type', 'application/json')\n    xhr.send(JSON.stringify({\n      base64: {\n        key: this.toB64()\n      }\n    }))\n  }\n  async sendFormData (xhr) {\n    const formData = await this.toFormData()\n    xhr.send(formData)\n  }\n  async toFormData () {\n    const formData = new FormData()\n    const responseFetch = await fetch(this.base64)\n    const blob = await responseFetch.blob()\n    formData.append('selfie', blob, 'image.png')\n    return formData\n  }\n\n  toB64 () {\n    const base64Local = this.base64\n    return base64Local.split(',')[1]\n  }\n\n  confirmPicture () {\n    try {\n      if (this.shouldAutoSendToApi) this.sendPictureByXmlRequest()\n    } catch (error) {\n      this.errorCallback({ error, base64: this.base64})\n    }\n  }\n  sendToApi () {\n    try {\n      this.sendPictureByXmlRequest()\n    } catch (error) {\n      this.errorCallback({ error, base64: this.base64})\n    }\n  }\n}\n\nmodule.exports = Liveness\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(80);\n"],"sourceRoot":""}