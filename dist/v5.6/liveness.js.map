{"version":3,"sources":["webpack://Liveness/./src/Livenessv5.6.js","webpack://Liveness/webpack/bootstrap","webpack://Liveness/webpack/startup"],"names":["module","exports","constructor","videoWrapper","config","windowWidth","window","innerWidth","this","width","height","Math","floor","token","faceapi","configFrameBox","frameBox","cssOrientationStyle","document","createElement","innerText","cssOrientationLock","head","appendChild","brightnessControl","luminanceControl","faceapiPath","isShowPreview","errorCallback","successCallback","livenessUrlBase","displaySize","livenessConfirmEndpoint","ellipseStrokeStyleDefault","ellipseStrokeStyle","activatedEllipseStrokeStyle","boxMessageBackgroundColor","boxMessageTextColor","configEyesBoxHeight","requestAnimationFrame","setMinBrightness","value","setMinLuminance","setFrameBoxesWidth","eyesInner","eyesOutter","box","setDimensionsRequestImage","dimensions","toggleDebug","isDebug","canvas","getContext","clearRect","setEyesBoxHeight","pixels","stop","video","pause","stream","getTracks","forEach","track","clearInterval","timer","timerBackground","callback","startCallbackFunction","setLiveness","loadFaceApi","setLoading","createModalConfirmationWrapper","createModalConfirmation","createVideoElement","startVideo","destroyLiveness","removeCanvas","resetVideoWrapper","resetLiveness","closePreviewModal","base64","removeLoading","createCanvasBackground","canvasBackground","clientWidth","getDevicePixelRatio","clientHeight","style","display","sweepVideo","data","luminanceAvg","brightnessSum","luminanceArray","x","length","r","g","b","sweepBrightness","sweepLuminance","checkBrightness","isMobile","test","navigator","userAgent","brightness","calcLuminance","push","luminance","colorFactor","colorArray","i","pow","mediaQuery","isFirefox","toLowerCase","indexOf","undefined","devicePixelRatio","matchMedia","matches","script","faceJS","src","append","onload","async","loadFaceApiModels","setTimeout","Promise","all","nets","faceLandmark68Net","loadFromUri","faceExpressionNet","faceRecognitionNet","then","tinyFaceDetector","console","log","catch","e","error","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","resolve","reject","call","Error","enumerateDevices","devices","frameRate","facingMode","backCamera","filter","device","kind","label","includes","deviceId","querySelector","srcObject","URL","createObjectURL","err","transform","setAttribute","position","addEventListener","createMessageBox","loop","getElementById","innerHTML","getElementsByTagName","remove","responsiveFrameBoxEyesOutterWidth","createCanvasFromMedia","left","top","matchDimensions","boxesWidth","ellipseMaskWidth","ellipseMaskHeight","ellipseMaskTop","ellipseMaskLeft","ellipseMaskLineWidth","ctx","translate","scale","drawEllipse","draw","canvasPosition","getBoundingClientRect","state","counter","inProgress","done","setInterval","checkBackground","detections","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceExpressions","blockMask","resizedDetections","resizeResults","expressions","expression","getExpression","detection","pose","getPose","jaw","landmarks","getJawOutline","isRotatedFace","beginPath","lineWidth","strokeStyle","moveTo","y","lineTo","stroke","leftEye","meanPosition","isInside","outterBox","innerBox","rightEye","isBackgroundOK","activateEllipseMask","takePicture","deactivateEllipseMask","rect","w","h","ellipse","PI","expArr","key","Object","entries","confidence","exp","sort","a","pop","res","eye_right","getMeanPosition","getRightEye","eye_left","getLeftEye","nose","getNose","mouth","getMouth","rx","getTop","ry","score","p1","p2","abs","atan2","l","map","reduce","min","message","msg","elMessage","textContent","context","createFlashMask","drawImage","toDataURL","removeFlashMask","openPreviewModal","confirmPicture","pictureData","getImageData","table","brilho","atual","parseFloat","toFixed","flash","background","zIndex","id","body","modalWrapper","modalConfirmation","confirmButton","cancelButton","footer","cancelPicture","image","modal","downloadImage","anchor","click","insertAdjacentHTML","spinner","base64Local","requestOptions","method","headers","JSON","stringify","replace","endpoint","fetch","response","json","result","statusCode","alert","finally","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"liveness.js","sourcesContent":["\"use strict\";\nclass Liveness {\n\n  constructor (videoWrapper, config) {\n    const windowWidth = window.innerWidth\n    this.config = config\n    if (config.width >= windowWidth) {\n      config.width = windowWidth\n    }\n\n    config.height = Math.floor(config.width * 0.7778)\n    this.token = config.token\n    this.videoWrapper = videoWrapper\n    this.faceapi = null\n    this.configFrameBox = config.frameBox\n\n    const cssOrientationStyle = document.createElement('style')\n    cssOrientationStyle.innerText = this.cssOrientationLock()\n    document.head.appendChild(cssOrientationStyle)\n    \n    if (config.brightnessControl) this.brightnessControl = config.brightnessControl\n    else this.brightnessControl = 95\n\n    if (config.luminanceControl) this.luminanceControl = config.luminanceControl\n    else this.luminanceControl = 23\n\n    this.faceapiPath = config.faceapiPath\n    this.isShowPreview = config.isShowPreview\n    this.errorCallback = config.errorCallback\n    this.successCallback = config.successCallback\n    this.livenessUrlBase = config.livenessUrlBase\n    this.displaySize = { width: config.width, height: config.height }\n    this.livenessConfirmEndpoint = config.livenessConfirmEndpoint || '/liveness/v2'\n    this.ellipseStrokeStyleDefault = config.ellipseStrokeStyle || '#D02780'\n    this.activatedEllipseStrokeStyle = config.activatedEllipseStrokeStyle || '#46E3C3'\n    this.boxMessageBackgroundColor = config.boxMessageBackgroundColor || '#D02780'\n    this.boxMessageTextColor = config.boxMessageTextColor || '#f3f3f5'\n    this.configEyesBoxHeight = config.configEyesBoxHeight || 100\n    this.requestAnimationFrame = window.requestAnimationFrame\n  }\n\n  setMinBrightness (value) {\n    this.brightnessControl = value\n  }\n\n  setMinLuminance (value) {\n    this.luminanceControl = value\n  }\n\n  setFrameBoxesWidth (eyesInner, eyesOutter, box) {\n    this.configFrameBox = {\n      eyesInner,\n      eyesOutter,\n      box\n    }\n  }\n  setDimensionsRequestImage (width, height) {\n    this.config.dimensions = {\n      width,\n      height\n    }\n  }\n  toggleDebug () {\n    this.config.isDebug = !this.config.isDebug\n    if (!this.config.isDebug) {\n      const ctx = this.canvas.getContext('2d')\n      ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    }\n  }\n\n  setEyesBoxHeight (pixels) {\n    this.configEyesBoxHeight = pixels\n  }\n\n  stop () {\n    this.video.pause()\n    const tracks = this.stream.getTracks()\n    tracks.forEach(track => track.stop())\n    clearInterval(this.timer)\n    clearInterval(this.timerBackground)\n  }\n\n  async start (callback) {\n    this.startCallbackFunction = callback\n    if (!window.faceapi) {\n      await this.loadFaceApi()\n    } else {\n      this.faceapi = window.faceapi\n      this.setLiveness()\n    }\n  }\n\n  setLiveness () {\n    this.setLoading()\n    this.createModalConfirmationWrapper()\n    .createModalConfirmation()\n    .createVideoElement()\n    .startVideo()\n  }\n\n  destroyLiveness () {\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n  }\n\n  resetLiveness () {\n    this.stop()\n    this.removeCanvas()\n    this.resetVideoWrapper()\n    this.closePreviewModal()\n    this.base64 = ''\n    this.removeLoading()\n    this.setLiveness()\n  }\n\n  cssOrientationLock () {\n    return '@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) { html { transform: rotate(-90deg);transform-origin: left top;width: 100vh;overflow-x: hidden;position: absolute;top: 100%;left: 0;}}'\n  }\n\n  createCanvasBackground () {\n    this.canvasBackground = document.createElement('canvas')\n    const width = this.videoWrapper.clientWidth * this.getDevicePixelRatio()\n    const height = this.videoWrapper.clientHeight * this.getDevicePixelRatio()\n    if (window.innerWidth < 720) {\n      this.canvasBackground.width = width * 2\n      this.canvasBackground.height = height * 2\n    } else {\n      this.canvasBackground.width = width\n      this.canvasBackground.height = height\n    }\n    \n    if (this.config.dimensions) {\n      this.canvasBackground.width = this.config.dimensions.width\n      this.canvasBackground.height = this.config.dimensions.height\n    }\n\n    this.canvasBackground.style.display = 'none'\n  }\n\n  sweepVideo (data) {\n    this.luminanceAvg = 0\n    this.brightnessSum = 0 \n    this.luminanceArray = []\n\n    for (let x = 0; x < data.length; x += 4) {\n      const r = data[x]\n      const g = data[x + 1]\n      const b = data[x + 2]\n      this.sweepBrightness(r, g, b)\n      this.sweepLuminance(r, g, b)\n    }\n    this.checkBrightness()\n  }\n\n  isMobile () {\n    const acceptedBrowser = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\n    return acceptedBrowser.test(navigator.userAgent)\n  }\n\n  checkBrightness () {\n    this.brightness = Math.floor(this.brightnessSum / (this.canvasBackground.width * this.canvasBackground.height))\n  }\n\n  sweepBrightness (r, g, b) {\n    this.brightnessSum += Math.floor((r + g + b) / 3)\n  }\n\n  sweepLuminance (r, g, b) {\n    this.luminanceAvg += this.calcLuminance(r, g, b)\n    this.luminanceArray.push(this.calcLuminance(r, g, b))     \n\n    this.luminance = (this.luminanceAvg / this.luminanceArray?.length) * 100\n  }\n\n  calcLuminance (r, g, b) {\n    let colorArray = [r, g, b]\n    let colorFactor\n    for (let i = 0; i < colorArray.length; i++) {\n        colorFactor = colorArray[i] / 255\n        if (colorFactor <= 0.03928) {\n            colorFactor = colorFactor / 12.92\n        } else {\n            colorFactor = Math.pow(((colorFactor + 0.055) / 1.055), 2.4)\n        }\n        colorArray[i] = colorFactor\n    }\n    return (colorArray[0] * 0.2126 + colorArray[1] * 0.7152 + colorArray[2] * 0.0722) + 0.05\n  }\n  getDevicePixelRatio () {\n    let mediaQuery\n    const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1\n    if (window.devicePixelRatio !== undefined && !isFirefox) {\n      return window.devicePixelRatio\n    } else if (window.matchMedia) {\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 1.5),\\\n        (min--moz-device-pixel-ratio: 1.5),\\\n        (-o-min-device-pixel-ratio: 3/2),\\\n        (min-resolution: 1.5dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 1.5\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 2),\\\n        (min--moz-device-pixel-ratio: 2),\\\n        (-o-min-device-pixel-ratio: 2/1),\\\n        (min-resolution: 2dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 2\n      }\n      mediaQuery = \"(-webkit-min-device-pixel-ratio: 0.75),\\\n        (min--moz-device-pixel-ratio: 0.75),\\\n        (-o-min-device-pixel-ratio: 3/4),\\\n        (min-resolution: 0.75dppx)\"\n      if (window.matchMedia(mediaQuery).matches) {\n        return 0.7\n      }\n    } else {\n      return 1\n    }\n  }\n\n  async loadFaceApi () {\n    const script = document.createElement('script')\n    const faceJS = `${this.faceapiPath}/face-api.min.js`\n    script.src = faceJS\n    document.head.append(script)\n    script.onload = async () => {\n      await this.loadFaceApiModels()\n    }\n    return this\n  }\n  async loadFaceApiModels () {\n    setTimeout(async () => {\n      Promise.all([\n        window.faceapi.nets.faceLandmark68Net.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceExpressionNet.loadFromUri(this.faceapiPath),\n        window.faceapi.nets.faceRecognitionNet.loadFromUri(this.faceapiPath)\n      ])\n      .then(async () => {\n        await window.faceapi.nets.tinyFaceDetector.loadFromUri(this.faceapiPath)\n        console.log('Models were loaded')\n        this.faceapi = faceapi\n        this.setLiveness()\n      })\n      .catch(e => console.error('error', e))\n    }, 100)\n    return this\n  }\n\n  startVideo () {\n    if (navigator.mediaDevices === undefined) {\n      navigator.mediaDevices = {}\n    }\n    if (navigator.mediaDevices.getUserMedia === undefined) {\n      navigator.mediaDevices.getUserMedia = function(constraints) {\n        const getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n        if (!getUserMedia) {\n          return Promise.reject(new Error('getUserMedia não implementado nesse browser'))\n        }\n        return new Promise(function(resolve, reject) {\n          getUserMedia.call(navigator, constraints, resolve, reject)\n        })\n      }\n    }\n    navigator.mediaDevices.enumerateDevices().then(devices => {\n      const constraints = {\n        video: {  \n          width: this.config.width,\n          height: this.config.height,\n          frameRate: 24\n        }\n      }\n      if (this.isMobile()) constraints.video = { facingMode: 'user' }\n      else {\n        const backCamera = devices.filter(device => device.kind === 'videoinput' && !device.label.includes('m-de:vice'))[0]\n        if (backCamera) constraints.video.deviceId = backCamera.deviceId\n      }\n\n      navigator.mediaDevices.getUserMedia(constraints).then((stream) => {\n          const video = document.querySelector('video')\n          this.stream = stream\n          if (\"srcObject\" in video) {\n            video.srcObject = stream\n          } else {\n            video.src = window.URL.createObjectURL(stream)\n          }\n          !!this.startCallbackFunction && this.startCallbackFunction()\n        }).catch(err => console.error(err))\n    })\n\n    return this\n  }\n  createVideoElement () {\n    this.video = document.createElement('video')\n    this.video.style.width = '100%'\n    this.video.style.height = '100%'\n    this.video.style.transform = 'scaleX(-1)'\n    this.video.setAttribute('muted', true)\n    this.video.setAttribute('autoplay', true)\n    this.video.setAttribute('playsinline', '')\n    this.videoWrapper.style.position = 'relative'\n    this.videoWrapper.style.width = this.config.width\n    this.videoWrapper.style.height = this.config.height\n    this.videoWrapper.append(this.video)\n    this.video.addEventListener('play', () => {\n      this.createMessageBox()\n      this.loop()\n      this.createCanvasBackground()\n    })\n    return this\n  }\n  resetVideoWrapper () {\n    const videoWrapper = document.getElementById('video-wrapper')\n    if(videoWrapper) videoWrapper.innerHTML = ''\n  }\n\n  removeCanvas () {\n    const canvas = document.getElementsByTagName('canvas')[0]\n    if(canvas) canvas.remove()\n  }\n\n  responsiveFrameBoxEyesOutterWidth (windowWidth) {\n    switch (windowWidth) {\n      case 315:\n        return {\n          eyesInner: 0.74,\n          eyesOutter: 0.78,\n          box: 0.55\n        }\n        break;\n    \n      default:\n        return {\n          eyesInner: 0.52,\n          eyesOutter: 0.82,\n          box: 0.60\n        }\n        break;\n    }\n  }\n  loop () {\n    if (this.video.style.width.includes('%')) {\n      this.displaySize.width = this.video.style.width = this.video.clientWidth\n      this.displaySize.height = this.video.style.height = this.video.clientHeight\n    }\n    this.canvas = this.faceapi.createCanvasFromMedia(this.video)\n\n    this.canvas.style.position = 'absolute'\n    this.canvas.style.left = 0\n    this.canvas.style.top = 0\n\n    this.videoWrapper.append(this.canvas)\n    this.faceapi.matchDimensions(this.canvas, this.displaySize)\n    this.boxesWidth = this.responsiveFrameBoxEyesOutterWidth(window.innerWidth)\n\n    if (this.configFrameBox) this.boxesWidth = this.configFrameBox\n\n    const frameBox = {\n      width: Math.floor(this.config.width * this.boxesWidth.box),\n      height: Math.floor(this.config.height * .922)\n    }\n    frameBox.left = Math.floor((this.canvas.width / 2) - (frameBox.width / 2))\n    frameBox.top = Math.floor( (this.videoWrapper.clientHeight / 2) - (frameBox.height / 2)  )\n\n    const height = frameBox.height + this.configEyesBoxHeight\n    const eyesOutter = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesOutter)),\n      height: Math.floor((height / 5))\n    }\n    eyesOutter.left = Math.floor((frameBox.left + (frameBox.width / 1.95) - (eyesOutter.width / 1.95)))\n    eyesOutter.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n\n    const eyesInner = {\n      width: Math.floor((frameBox.width * this.boxesWidth.eyesInner)),\n      height: Math.floor((height / 5))\n    }\n    eyesInner.left = Math.floor((frameBox.left + (frameBox.width / 1.96) - (eyesInner.width / 1.96)))\n    eyesInner.top = Math.floor(frameBox.top + (frameBox.height * 0.3))\n\n    this.ellipseMaskWidth = eyesInner.height + (eyesInner.height * 0.3)\n    this.ellipseMaskHeight = frameBox.width / 2\n    this.ellipseMaskTop = eyesOutter.top + (eyesOutter.height / 1.4)\n    this.ellipseMaskLeft = eyesOutter.left + (eyesOutter.width / 2)\n    this.ellipseMaskLineWidth = 2\n\n    const ctx = this.canvas.getContext('2d')\n    ctx.translate(this.canvas.width, 0)\n    ctx.scale(-1, 1)\n    this.drawEllipse(ctx)\n    // DEBUG\n    if (this.config.isDebug) {\n      this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n    }\n\n\n    const canvasPosition = this.canvas.getBoundingClientRect()\n    const state = {\n      counter: 0,\n      inProgress: false,\n      done: false\n    }\n\n    this.timerBackground = setInterval(() => {\n      this.checkBackground()\n    }, 3000);\n\n    this.timer = setInterval(async () => {\n      if (state.inProgress || state.done) {\n        return\n      }\n      state.inProgress = true\n\n      const detections = await this.faceapi.detectSingleFace(this.video, new this.faceapi.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceExpressions()\n\n      this.removeLoading()\n\n      if (!detections) {\n        this.blockMask('Face não encontrada', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n        state.counter = 0\n        state.inProgress = false\n        return\n      }\n\n      const resizedDetections = this.faceapi.resizeResults(detections, this.displaySize)\n\n      if (resizedDetections && resizedDetections.expressions) {  \n        const expression = this.getExpression(resizedDetections.expressions)\n        if (expression !== 'neutral') {\n          if (this.config.isDebug) {\n            this.blockMask(`Mantenha expressão neutra >> ${expression}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Mantenha expressão neutra', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n      }\n      \n      if (resizedDetections.detection) {\n\n        // POSE\n        const pose = this.getPose(resizedDetections)\n        if (pose !== 'front') {\n          if (this.config.isDebug) {\n            this.blockMask(`Centralize seu rosto >> ${pose}`, canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // ANGLE\n        const jaw = resizedDetections.landmarks.getJawOutline()\n        const rotated = this.isRotatedFace(jaw[0], jaw[16])\n        if (rotated) {\n          if (this.config.isDebug) {\n            this.blockMask('Centralize seu rosto >> rotacionado', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          } else {\n            this.blockMask('Centralize seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          }\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        // DEBUG\n        if (this.config.isDebug) {\n          this.draw(ctx, this.canvas, frameBox, eyesInner, eyesOutter)\n          ctx.beginPath()\n          ctx.lineWidth = '5'\n          ctx.strokeStyle = '#FFFF00'\n          ctx.moveTo(jaw[0].x, jaw[0].y)\n          ctx.lineTo(jaw[16].x, jaw[16].y)\n          ctx.stroke()\n        }\n\n\n        const leftEye = {\n          meanPosition: [jaw[0].x, jaw[0].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n        const rightEye = { \n          meanPosition: [jaw[16].x, jaw[16].y],\n          frameBox: { isInside: false },\n          outterBox: { isInside: false },\n          innerBox: { isInside: false }\n        }\n\n        leftEye.frameBox.isInside = this.isInside(leftEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n        rightEye.frameBox.isInside = this.isInside(rightEye.meanPosition, { top: frameBox.top, left: frameBox.left, width: frameBox.width, height: frameBox.height })\n\n        leftEye.outterBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n        rightEye.outterBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesOutter.top, left: eyesOutter.left, width: eyesOutter.width, height: eyesOutter.height })\n\n        leftEye.innerBox.isInside = this.isInside(leftEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n        rightEye.innerBox.isInside = this.isInside(rightEye.meanPosition, { top: eyesInner.top, left: eyesInner.left, width: eyesInner.width, height: eyesInner.height })\n\n\n        if (!this.isBackgroundOK) {\n          this.blockMask('O ambiente está escuro', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.frameBox.isInside || !rightEye.frameBox.isInside) {\n          this.blockMask('Posicione seu rosto dentro da moldura', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (!leftEye.outterBox.isInside || !rightEye.outterBox.isInside) {\n          this.blockMask('Afaste seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        if (leftEye.innerBox.isInside || rightEye.innerBox.isInside) {\n          this.blockMask('Aproxime seu rosto', canvasPosition, frameBox.left, frameBox.top, frameBox.height, frameBox.width)\n          state.counter = 0\n          state.inProgress = false\n          return\n        }\n\n        this.ellipseMaskLineWidth *= 2\n        this.activateEllipseMask()\n    \n        state.counter += 1\n        state.inProgress = false\n        if (state.counter >= 2) {\n          state.done = true\n          this.takePicture()\n          clearInterval(this.timer)\n          clearInterval(this.timerBackground)\n        }\n      }\n      \n    }, 150)\n  }\n\n  activateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.drawEllipse(ctx, this.activatedEllipseStrokeStyle)\n  }\n\n  deactivateEllipseMask () {\n    const ctx = this.canvas.getContext('2d')\n    this.ellipseMaskLineWidth = 3\n    this.drawEllipse(ctx)\n  }\n  \n  draw (ctx, canvas, frameBox, eyesInner, eyesOutter) {\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    ctx.beginPath()\n    ctx.lineWidth = 3\n    ctx.strokeStyle = 'blue'\n    ctx.rect(frameBox.left, frameBox.top, frameBox.width, frameBox.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'yellow'\n    ctx.rect(eyesInner.left, eyesInner.top, eyesInner.width, eyesInner.height)\n    ctx.stroke()\n  \n    ctx.beginPath()\n    ctx.lineWidth = 2\n    ctx.strokeStyle = 'red'\n    ctx.rect(eyesOutter.left, eyesOutter.top, eyesOutter.width, eyesOutter.height)\n    ctx.stroke()\n    this.drawEllipse(ctx)\n  }\n\n\n  drawEllipse(ctx, style) {\n    const x = this.ellipseMaskLeft\n    const y = this.ellipseMaskTop\n    const w = this.ellipseMaskWidth\n    const h = this.ellipseMaskHeight\n\n    ctx.beginPath()\n    ctx.lineWidth = this.ellipseMaskLineWidth\n\n    ctx.ellipse(x, y, w, h, 0, 0, Math.PI * 2)\n    ctx.strokeStyle = style || this.ellipseStrokeStyleDefault\n\n    ctx.stroke();\n  }\n  getExpression (expressions) {\n    const expArr = []\n    for (const [key, value] of Object.entries(expressions)) {\n      expArr.push({ expression: key, confidence: value })\n    }\n    const exp = expArr.sort((a, b) => a.confidence - b.confidence).pop()\n    return (exp && exp.expression) ? exp.expression : null\n  }\n  getPose(res) {\n    const eye_right = this.getMeanPosition(res.landmarks.getRightEye())\n    const eye_left = this.getMeanPosition(res.landmarks.getLeftEye())\n    const nose = this.getMeanPosition(res.landmarks.getNose())\n    const mouth = this.getMeanPosition(res.landmarks.getMouth())\n    const jaw = this.getTop(res.landmarks.getJawOutline())\n    const rx = (jaw - mouth[1]) / res.detection.box.height + 0.45\n    const ry = (eye_left[0] + (eye_right[0] - eye_left[0]) / 2 - nose[0]) / res.detection.box.width\n    let state = 'undetected'\n\n    if (res.detection.score > 0.3) {\n      state = 'front'\n      if (rx > 0.2) {\n        state = 'top'\n      } else if (rx < -0.1) {\n        state = 'bottom'\n      } else {\n        if (ry < -0.04) {\n          state = 'left'\n        }\n        if (ry > 0.04) {\n          state = 'right'\n        }\n      }\n    }\n    return state\n  }\n  isRotatedFace (p1, p2) {\n    const angleDeg = Math.abs(Math.atan2(p2.y - p1.y, p2.x - p1.x) * 180 / Math.PI)\n    return angleDeg > 7\n  }\n  getMeanPosition (l) {\n    return l\n      .map((a) => [a.x, a.y])\n      .reduce((a, b) => [a[0] + b[0], a[1] + b[1]])\n      .map((a) => a / l.length)\n  }\n  getTop (l) {\n    return l\n      .map((a) => a.y)\n      .reduce((a, b) => Math.min(a, b))\n  }\n  isInside (a = [], b = {}) {\n    if (a[1] < b.top) {\n      return false\n    }\n    if (a[0] < b.left) {\n      return false\n    }\n    if (a[1] > b.top + b.height) {\n      return false\n    }\n    if (a[0] > b.left + b.width) {\n      return false\n    }\n    return true\n  }\n  blockMask (message, canvasPosition, left, top, height, width) {\n    const MASK_WHITE_BORDER = 50\n    const dimensions = {\n      width: 230,\n      height: 35\n    }\n    dimensions.top = top + height + 20\n    dimensions.left = (left + (width / 2)) - (dimensions.width / 2)\n\n\n    this.deactivateEllipseMask()\n\n    this.msg.innerHTML = ''\n    const elMessage = document.createElement('span')\n    elMessage.textContent = message\n    elMessage.style = \n    `\n      display: flex;\n      color: ${this.boxMessageTextColor};\n      z-index: 20;\n      font-size: 1.1rem;\n      padding: 10px 20px;\n      text-align: center;\n      align-items: center;\n      background: ${this.boxMessageBackgroundColor};\n      border-radius: 7px;\n      justify-content: center;\n      width: ${dimensions.width}px;\n      height: ${dimensions.height}px;\n      font-family: Prompt, sans-serif;\n    `\n    this.msg.style.display = 'flex'\n    this.msg.appendChild(elMessage)\n  }\n  takePicture () {\n    const context = this.canvasBackground.getContext('2d')\n    this.canvasBackground.style.display = 'none;'\n    this.createFlashMask()\n    context.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    this.base64 = this.canvasBackground.toDataURL('image/png')\n\n    setTimeout(() => {\n      this.removeFlashMask()\n\n      if(this.isShowPreview) {\n        this.openPreviewModal()\n      }\n      else {\n        this.confirmPicture()\n      }\n      \n    }, 300)\n  }\n  checkBackground () {\n    if (!this.canvasBackground) return\n\n    const context = this.canvasBackground.getContext('2d')\n\n    context.drawImage(this.video, 0, 0, this.canvasBackground.width, this.canvasBackground.height)\n    const pictureData = context.getImageData(0,0,this.canvasBackground.width,this.canvasBackground.height)\n    this.sweepVideo(pictureData.data)\n\n    this.isBackgroundOK = (this.brightness >= this.brightnessControl && this.luminance >= this.luminanceControl)\n\n    if (this.config.isDebug) {\n      const table = {\n        brilho: {\n          atual: this.brightness,\n          'mín aceitável': this.brightnessControl,\n        },\n        'luminânia': {\n          atual: parseFloat(this.luminance.toFixed(2)),\n          'mín aceitável': this.luminanceControl\n        }\n      }\n      console.table(table)\n    }\n  }\n  createFlashMask () {\n    const flash = document.createElement('div')\n    flash.style.width = '100%'\n    flash.style.height = '100vh'\n    flash.style.position = 'fixed'\n    flash.style.background = 'white'\n    flash.style.zIndex = 30\n    flash.style.top = 0\n    flash.style.left = 0\n    flash.id = 'flash'\n    document.body.append(flash)\n  }\n  removeFlashMask () {\n    const flash = document.getElementById('flash')\n    flash.remove()\n  }\n  createMessageBox () {\n    this.msg = document.createElement('div')\n    this.msg.style = `\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      background: transparent;\n      position: absolute;\n      bottom: 0;\n    `\n    this.videoWrapper.append(this.msg)\n    return this\n  }\n  createModalConfirmationWrapper () {\n    this.modalWrapper = document.createElement('div')\n    this.modalWrapper.style = `\n    top: 0;\n    left: 0;\n    z-index: 10;\n    width: 100%;\n    height: 100%;\n    display: none;\n    position: fixed;\n    align-items: center;\n    justify-content: center;\n    background: rgba(20, 20, 20, 0.95);\n    `\n    this.modalWrapper.id = 'modalWrapper'\n    document.body.append(this.modalWrapper)\n    return this\n  }\n  createModalConfirmation () {\n    this.modalConfirmation = document.createElement('div')\n    this.modalConfirmation.style = `\n    padding: 7px;\n    display: flex;\n    max-width: 720px;\n    background: white;\n    max-height: 560px;\n    border-radius: 7px;\n    position: relative;\n    align-items: center;\n    justify-content: center;\n    `\n    const confirmButton = document.createElement('button')\n    confirmButton.textContent = 'Confirmar'\n    confirmButton.style = `\n    color: #555;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const cancelButton = document.createElement('button')\n    cancelButton.textContent = 'Cancelar'\n    cancelButton.style = `\n    color: #444;\n    right: 10px;\n    width: 160px;\n    height: 50px;\n    bottom: 10px;\n    cursor: pointer;\n    background: #fff;\n    font-weight: 600;\n    border-radius: 7px;\n    margin-right: 10px;\n    border: 1px solid #222;\n    `\n    const footer = document.createElement('div')\n    footer.style = `\n    right: 0;\n    bottom: 0;\n    width: 100%;\n    display: flex;\n    padding: 10px 0;\n    position: absolute;\n    justify-content: center;\n    `\n    footer.append(cancelButton)\n    footer.append(confirmButton)\n    this.modalConfirmation.append(footer)\n    this.modalWrapper.append(this.modalConfirmation)\n    confirmButton.addEventListener('click', () => {\n      this.closePreviewModal()\n      this.confirmPicture()\n    })\n    cancelButton.addEventListener('click', () => {\n      this.cancelPicture()\n    })\n    return this\n  }\n\n  openPreviewModal () {\n    const image = document.createElement('img')\n    image.src = this.base64\n    image.style = `\n      max-width: ${this.canvasBackground.width};\n      min-width: ${this.canvasBackground.width};\n      min-height: ${this.canvasBackground.height};\n      max-height: ${this.canvasBackground.height};\n      object-fit: cover;\n      border-radius: 7px;\n    `\n    this.modalConfirmation.append(image)\n    this.modalWrapper.style.display = 'flex'\n  }\n\n  closePreviewModal () {\n    const modal = document.getElementById('modalWrapper')\n    if (modal) modal.remove()\n  }\n\n  cancelPicture () {\n    this.resetLiveness()\n  }\n\n  downloadImage () {\n    const anchor = createElement('a')\n    anchor.setAttribute('download', 'image.png')\n    anchor.setAttribute('href', this.base64)\n    anchor.click()\n    setTimeout(() => {\n      anchor.remove()\n    }, 1000);\n  }\n\n  setLoading () { \n    const spinner = `<div id=\"spinner\">\n        <div class=\"lds-ripple\">\n          <div style=\"color: white\"></div>\n          <div style=\"color: white\"></div>\n        </div>\n\n        <style>\n        #spinner {\n          z-index: 40;\n          width: 100%;\n          height: 100%;\n          display: flex;\n          position: absolute;\n          align-items: center;\n          justify-content: center;\n          background: rgba(20, 20, 20, 1);\n          top: 0;\n        }\n        .lds-ripple {\n          width: 80px;\n          height: 80px;\n          position: relative;\n        }\n        .lds-ripple div {\n          position: absolute;\n          border: 4px solid #000;\n          opacity: 1;\n          border-radius: 50%;\n          border-color: white;\n          animation: lds-ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;\n        }\n        .lds-ripple div:nth-child(2) {\n          animation-delay: -0.5s;\n        }\n        @keyframes lds-ripple {\n          0% {\n            top: 36px;\n            left: 36px;\n            width: 0;\n            height: 0;\n            opacity: 1;\n            color: white;\n          }\n          100% {\n            top: 0px;\n            left: 0px;\n            width: 72px;\n            height: 72px;\n            opacity: 0;\n          }\n        }\n        </style>\n      </div>`\n    this.videoWrapper.insertAdjacentHTML('beforeend', spinner)\n  }\n  removeLoading () {\n    const spinner = document.getElementById('spinner')\n    if(spinner) spinner.remove()\n  }\n\n  confirmPicture () {\n    const base64Local = this.base64\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.token}`\n      },\n      body: JSON.stringify({\n        base64: {\n          key: base64Local.replace('data:image/png;base64,', '')\n        }\n      })\n    }\n    this.setLoading()\n    const endpoint = `${this.livenessUrlBase}${this.livenessConfirmEndpoint}`\n    fetch(endpoint, requestOptions)\n      .then(response => response.json())\n      .then(result => {\n        if (result?.data) {\n          this.successCallback({...result, base64: this.base64})\n          return\n        }\n\n        if (result?.error?.statusCode === 401) {\n          alert('Token inválido')\n          return\n        }\n\n        this.errorCallback({ error: result?.error, base64: this.base64})\n        console.error('error:', result?.error?.message)\n\n      })\n      .catch(error => {\n        error.base64 = this.base64\n        this.errorCallback(error)\n      })\n      .finally(() => {\n        this.resetLiveness()\n        this.removeLoading()\n      })\n  }\n}\n\nmodule.exports = Liveness\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(584);\n"],"sourceRoot":""}